<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Organizing and Processing Point Count Data | Point count data analysis: How to violate assumptions and get away with it</title>
  <meta name="description" content="This book provides material for the workshop ‘Analysis of point-count data in the presence of variable survey methodologies and detection error’ at the AOS 2019 conference." />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Organizing and Processing Point Count Data | Point count data analysis: How to violate assumptions and get away with it" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://peter.solymos.org/qpad-book/" />
  <meta property="og:image" content="http://peter.solymos.org/qpad-book/images/cover.png" />
  <meta property="og:description" content="This book provides material for the workshop ‘Analysis of point-count data in the presence of variable survey methodologies and detection error’ at the AOS 2019 conference." />
  <meta name="github-repo" content="psolymos/qpad-book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Organizing and Processing Point Count Data | Point count data analysis: How to violate assumptions and get away with it" />
  
  <meta name="twitter:description" content="This book provides material for the workshop ‘Analysis of point-count data in the presence of variable survey methodologies and detection error’ at the AOS 2019 conference." />
  <meta name="twitter:image" content="http://peter.solymos.org/qpad-book/images/cover.png" />

<meta name="author" content="Peter Solymos" />


<meta name="date" content="2019-06-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html">
<link rel="next" href="regression.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">QPAD Book</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-book-and-the-course"><i class="fa fa-check"></i>About the book and the course</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-author"><i class="fa fa-check"></i>About the author</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#installing-r-and-rstudio"><i class="fa fa-check"></i>Installing R and RStudio</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#installing-required-packages"><i class="fa fa-check"></i>Installing required packages</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#installing-the-book"><i class="fa fa-check"></i>Installing the book</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-this-works"><i class="fa fa-check"></i>How this works</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#design-based-approaches"><i class="fa fa-check"></i><b>1.1</b> Design-based approaches</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#model-based-approaches"><i class="fa fa-check"></i><b>1.2</b> Model-based approaches</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#our-approach"><i class="fa fa-check"></i><b>1.3</b> Our approach</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="pcdata.html"><a href="pcdata.html"><i class="fa fa-check"></i><b>2</b> Organizing and Processing Point Count Data</a><ul>
<li class="chapter" data-level="2.1" data-path="pcdata.html"><a href="pcdata.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="pcdata.html"><a href="pcdata.html#prerequisites"><i class="fa fa-check"></i><b>2.2</b> Prerequisites</a></li>
<li class="chapter" data-level="2.3" data-path="pcdata.html"><a href="pcdata.html#rbasics"><i class="fa fa-check"></i><b>2.3</b> R basics</a></li>
<li class="chapter" data-level="2.4" data-path="pcdata.html"><a href="pcdata.html#josm-data-set"><i class="fa fa-check"></i><b>2.4</b> JOSM data set</a></li>
<li class="chapter" data-level="2.5" data-path="pcdata.html"><a href="pcdata.html#cross-tabulating-species-counts"><i class="fa fa-check"></i><b>2.5</b> Cross tabulating species counts</a></li>
<li class="chapter" data-level="2.6" data-path="pcdata.html"><a href="pcdata.html#joining-species-data-with-predictors"><i class="fa fa-check"></i><b>2.6</b> Joining species data with predictors</a></li>
<li class="chapter" data-level="2.7" data-path="pcdata.html"><a href="pcdata.html#explore-predictor-variables"><i class="fa fa-check"></i><b>2.7</b> Explore predictor variables</a></li>
<li class="chapter" data-level="2.8" data-path="pcdata.html"><a href="pcdata.html#derived-variables"><i class="fa fa-check"></i><b>2.8</b> Derived variables</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i><b>3</b> A Primer in Regression Techniques</a><ul>
<li class="chapter" data-level="3.1" data-path="regression.html"><a href="regression.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="regression.html"><a href="regression.html#prerequisites-1"><i class="fa fa-check"></i><b>3.2</b> Prerequisites</a></li>
<li class="chapter" data-level="3.3" data-path="regression.html"><a href="regression.html#poisson-null-model"><i class="fa fa-check"></i><b>3.3</b> Poisson null model</a></li>
<li class="chapter" data-level="3.4" data-path="regression.html"><a href="regression.html#exploring-covariates"><i class="fa fa-check"></i><b>3.4</b> Exploring covariates</a></li>
<li class="chapter" data-level="3.5" data-path="regression.html"><a href="regression.html#single-covariate"><i class="fa fa-check"></i><b>3.5</b> Single covariate</a></li>
<li class="chapter" data-level="3.6" data-path="regression.html"><a href="regression.html#additive-model"><i class="fa fa-check"></i><b>3.6</b> Additive model</a></li>
<li class="chapter" data-level="3.7" data-path="regression.html"><a href="regression.html#nonlinear-terms"><i class="fa fa-check"></i><b>3.7</b> Nonlinear terms</a></li>
<li class="chapter" data-level="3.8" data-path="regression.html"><a href="regression.html#categorical-variables"><i class="fa fa-check"></i><b>3.8</b> Categorical variables</a></li>
<li class="chapter" data-level="3.9" data-path="regression.html"><a href="regression.html#multiple-main-effects"><i class="fa fa-check"></i><b>3.9</b> Multiple main effects</a></li>
<li class="chapter" data-level="3.10" data-path="regression.html"><a href="regression.html#interaction"><i class="fa fa-check"></i><b>3.10</b> Interaction</a></li>
<li class="chapter" data-level="3.11" data-path="regression.html"><a href="regression.html#different-error-distributions"><i class="fa fa-check"></i><b>3.11</b> Different error distributions</a></li>
<li class="chapter" data-level="3.12" data-path="regression.html"><a href="regression.html#count-duration-effects"><i class="fa fa-check"></i><b>3.12</b> Count duration effects</a></li>
<li class="chapter" data-level="3.13" data-path="regression.html"><a href="regression.html#count-radius-effects"><i class="fa fa-check"></i><b>3.13</b> Count radius effects</a></li>
<li class="chapter" data-level="3.14" data-path="regression.html"><a href="regression.html#offsets"><i class="fa fa-check"></i><b>3.14</b> Offsets</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="behavior.html"><a href="behavior.html"><i class="fa fa-check"></i><b>4</b> Behavioral Complexities</a><ul>
<li class="chapter" data-level="4.1" data-path="behavior.html"><a href="behavior.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="behavior.html"><a href="behavior.html#prerequisites-2"><i class="fa fa-check"></i><b>4.2</b> Prerequisites</a></li>
<li class="chapter" data-level="4.3" data-path="behavior.html"><a href="behavior.html#birds-in-the-forest"><i class="fa fa-check"></i><b>4.3</b> Birds in the forest</a></li>
<li class="chapter" data-level="4.4" data-path="behavior.html"><a href="behavior.html#survival-model"><i class="fa fa-check"></i><b>4.4</b> Survival model</a></li>
<li class="chapter" data-level="4.5" data-path="behavior.html"><a href="behavior.html#vocalization-events"><i class="fa fa-check"></i><b>4.5</b> Vocalization events</a></li>
<li class="chapter" data-level="4.6" data-path="behavior.html"><a href="behavior.html#removal-model"><i class="fa fa-check"></i><b>4.6</b> Removal model</a><ul>
<li class="chapter" data-level="4.6.1" data-path="behavior.html"><a href="behavior.html#real-data"><i class="fa fa-check"></i><b>4.6.1</b> Real data</a></li>
<li class="chapter" data-level="4.6.2" data-path="behavior.html"><a href="behavior.html#time-invariant-conventional-model"><i class="fa fa-check"></i><b>4.6.2</b> Time-invariant conventional model</a></li>
<li class="chapter" data-level="4.6.3" data-path="behavior.html"><a href="behavior.html#time-varying-conventional-removal-model"><i class="fa fa-check"></i><b>4.6.3</b> Time-varying conventional removal model</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="behavior.html"><a href="behavior.html#finite-mixtures"><i class="fa fa-check"></i><b>4.7</b> Finite mixtures</a><ul>
<li class="chapter" data-level="4.7.1" data-path="behavior.html"><a href="behavior.html#time-invariant-finite-mixture-removal-model"><i class="fa fa-check"></i><b>4.7.1</b> Time-invariant finite mixture removal model</a></li>
<li class="chapter" data-level="4.7.2" data-path="behavior.html"><a href="behavior.html#time-varying-finite-mixture-removal-models"><i class="fa fa-check"></i><b>4.7.2</b> Time-varying finite mixture removal models</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="behavior.html"><a href="behavior.html#let-the-best-model-win"><i class="fa fa-check"></i><b>4.8</b> Let the best model win</a></li>
<li class="chapter" data-level="4.9" data-path="behavior.html"><a href="behavior.html#estimating-abundance"><i class="fa fa-check"></i><b>4.9</b> Estimating abundance</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="detection.html"><a href="detection.html"><i class="fa fa-check"></i><b>5</b> The Detection Process</a></li>
<li class="chapter" data-level="6" data-path="recordings.html"><a href="recordings.html"><i class="fa fa-check"></i><b>6</b> Dealing with Recordings</a></li>
<li class="chapter" data-level="7" data-path="assumptions.html"><a href="assumptions.html"><i class="fa fa-check"></i><b>7</b> A Closer Look at Assumptions</a></li>
<li class="chapter" data-level="8" data-path="roadsides.html"><a href="roadsides.html"><i class="fa fa-check"></i><b>8</b> Understanding Roadside Surveys</a></li>
<li class="chapter" data-level="9" data-path="extras.html"><a href="extras.html"><i class="fa fa-check"></i><b>9</b> Miscellaneous Topics</a><ul>
<li class="chapter" data-level="" data-path="extras.html"><a href="extras.html#these-are-just-reminders-to-be-deleted-later"><i class="fa fa-check"></i>These are just reminders, to be deleted later</a></li>
<li class="chapter" data-level="9.1" data-path="extras.html"><a href="extras.html#binomial-model-and-censoring"><i class="fa fa-check"></i><b>9.1</b> Binomial model and censoring</a></li>
<li class="chapter" data-level="9.2" data-path="extras.html"><a href="extras.html#optimal-partitioning"><i class="fa fa-check"></i><b>9.2</b> Optimal partitioning</a></li>
<li class="chapter" data-level="9.3" data-path="extras.html"><a href="extras.html#optilevels"><i class="fa fa-check"></i><b>9.3</b> Optilevels</a></li>
<li class="chapter" data-level="9.4" data-path="extras.html"><a href="extras.html#n-mixture-models"><i class="fa fa-check"></i><b>9.4</b> N-mixture models</a></li>
<li class="chapter" data-level="9.5" data-path="extras.html"><a href="extras.html#estimating-abundance-1"><i class="fa fa-check"></i><b>9.5</b> Estimating abundance</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="http://peter.solymos.org/" target="blank">P&eacute;ter S&oacute;lymos</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Point count data analysis: How to violate assumptions and get away with it</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="pcdata" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Organizing and Processing Point Count Data</h1>
<blockquote>
<p>All data are messy, but some are missing</p>
</blockquote>
<div id="introduction" class="section level2">
<h2><span class="header-section-number">2.1</span> Introduction</h2>
<p>It is often called <em>data processing</em>, <em>data munging</em>,
<em>data wrangling</em>, <em>data cleaning</em>.
None of these expressions capture the dread associated with the actual activity.
Luckily, this book and course is not about data manipulation,
and we can gladly skip these steps. But keep in mind,
in real life, you’ll often have to worry about at least four things
that can go wrong:</p>
<ol style="list-style-type: decimal">
<li>space (e.g. wrong UTM zones, errors),</li>
<li>time (ISO format please),</li>
<li>taxonomy (unknowns, mis-identifications),</li>
<li>something else (if there were no errors, check again).</li>
</ol>
<p>This chapter sets you up for the required data skills for the
rest of the book/course.</p>
</div>
<div id="prerequisites" class="section level2">
<h2><span class="header-section-number">2.2</span> Prerequisites</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mefa4)                <span class="co"># data manipulation</span>
<span class="kw">library</span>(raster)               <span class="co"># reading raster files</span></code></pre>
<pre><code>## Loading required package: sp</code></pre>
<pre><code>## 
## Attaching package: &#39;raster&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:MASS&#39;:
## 
##     area, select</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sp)                   <span class="co"># spatial data manipulation</span>
<span class="kw">load</span>(<span class="st">&quot;_data/josm/josm.rda&quot;</span>)   <span class="co"># load bird data</span>
rr &lt;-<span class="st"> </span><span class="kw">stack</span>(<span class="st">&quot;_data/josm/landcover-hfi2016.grd&quot;</span>) <span class="co"># rasters</span></code></pre>
</div>
<div id="rbasics" class="section level2">
<h2><span class="header-section-number">2.3</span> R basics</h2>
<p>This short document is intended to help you brush up your R skills.
If you feel that these R basics are not very familiar,
I suggest to take a look at some introductory R books,
sich as this preprint version of Norman Matloff’s <em>The Art of R Programming</em> book: <a href="http://heather.cs.ucdavis.edu/~matloff/132/NSPpart.pdf" class="uri">http://heather.cs.ucdavis.edu/~matloff/132/NSPpart.pdf</a>, check out Chapters 1–6.</p>
<p>R is a great calculator:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span></code></pre>
<p>Assign a value and print an object using <code>=</code> or <code>&lt;-</code> (preferred in this book):</p>
<pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">x =</span> <span class="dv">2</span>) <span class="co"># shorthand for print</span>
<span class="kw">print</span>(x)
x <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="co"># logical operator, not assignment</span>
y &lt;-<span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span>
y <span class="co"># another way to print</span></code></pre>
<p>Logical operators come handy:</p>
<pre class="sourceCode r"><code class="sourceCode r">x <span class="op">==</span><span class="st"> </span>y <span class="co"># equal</span>
x <span class="op">!=</span><span class="st"> </span>y <span class="co"># not eaqual</span>
x <span class="op">&lt;</span><span class="st"> </span>y <span class="co"># smaller than</span>
x <span class="op">&gt;=</span><span class="st"> </span>y <span class="co"># greater than or equal</span></code></pre>
<p>Vectors and sequences are created most often by the functions
<code>c</code>, <code>:</code>, <code>seq</code>, and <code>rep</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)
x
<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>
<span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dt">by =</span> <span class="dv">1</span>)

<span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>)
<span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">5</span>)
<span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">each =</span> <span class="dv">5</span>)</code></pre>
<p>When doing operations with vectors remember that values of
the shorter object are recycled:</p>
<pre class="sourceCode r"><code class="sourceCode r">x <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span>
x <span class="op">*</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>)</code></pre>
<p>Indexing and ordering vectors is a a fundamental skill:</p>
<pre class="sourceCode r"><code class="sourceCode r">x[<span class="dv">1</span>]
x[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)] <span class="co"># a way of repeatig values</span>
x[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]
x[x <span class="op">!=</span><span class="st"> </span><span class="dv">2</span>]
x[x <span class="op">==</span><span class="st"> </span><span class="dv">2</span>]
x[x <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>x <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span>]
<span class="kw">order</span>(x, <span class="dt">decreasing=</span><span class="ot">TRUE</span>)
x[<span class="kw">order</span>(x, <span class="dt">decreasing=</span><span class="ot">TRUE</span>)]
<span class="kw">rev</span>(x) <span class="co"># reverse</span></code></pre>
<p>See how <code>NA</code> values can influence
sorting character vectors:</p>
<pre class="sourceCode r"><code class="sourceCode r">z &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;b&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="ot">NA</span>)
z[z <span class="op">==</span><span class="st"> &quot;a&quot;</span>]
z[<span class="op">!</span><span class="kw">is.na</span>(z) <span class="op">&amp;</span><span class="st"> </span>z <span class="op">==</span><span class="st"> &quot;a&quot;</span>]
z[<span class="kw">is.na</span>(z) <span class="op">|</span><span class="st"> </span>z <span class="op">==</span><span class="st"> &quot;a&quot;</span>]
<span class="kw">is.na</span>(z)
<span class="kw">which</span>(<span class="kw">is.na</span>(z))
<span class="kw">sort</span>(z)
<span class="kw">sort</span>(z, <span class="dt">na.last=</span><span class="ot">TRUE</span>)</code></pre>
<p>There are a few special values:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.numeric</span>(<span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;a&quot;</span>)) <span class="co"># NA: not available (missing or invalid)</span>
<span class="dv">0</span><span class="op">/</span><span class="dv">0</span> <span class="co"># NaN: not a number</span>
<span class="dv">1</span><span class="op">/</span><span class="dv">0</span> <span class="co"># Inf</span>
<span class="dv">-1</span><span class="op">/</span><span class="dv">0</span> <span class="co"># -Inf</span></code></pre>
<p>Matrices and arrays are vectors with dimensions, elements are in same mode:</p>
<pre class="sourceCode r"><code class="sourceCode r">(m &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dv">4</span>, <span class="dv">3</span>))
<span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)

<span class="kw">array</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>))</code></pre>
<p>Many objects have attributes:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(m)
<span class="kw">dim</span>(m) &lt;-<span class="st"> </span><span class="ot">NULL</span>
m
<span class="kw">dim</span>(m) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">3</span>)
m
<span class="kw">dimnames</span>(m) &lt;-<span class="st"> </span><span class="kw">list</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>], LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])
m
<span class="kw">attributes</span>(m)</code></pre>
<p>Matrice and indices:</p>
<pre class="sourceCode r"><code class="sourceCode r">m[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,]
m[<span class="dv">1</span>,<span class="dv">2</span>]
m[,<span class="dv">2</span>]
m[,<span class="dv">2</span>,drop=<span class="ot">FALSE</span>]
m[<span class="dv">2</span>]

m[<span class="kw">rownames</span>(m) <span class="op">==</span><span class="st"> &quot;c&quot;</span>,]
m[<span class="kw">rownames</span>(m) <span class="op">!=</span><span class="st"> &quot;c&quot;</span>,]
m[<span class="kw">rownames</span>(m) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;e&quot;</span>),]
m[<span class="op">!</span>(<span class="kw">rownames</span>(m) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;e&quot;</span>)),]</code></pre>
<p>Lists and indexing:</p>
<pre class="sourceCode r"><code class="sourceCode r">l &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">m =</span> m, <span class="dt">x =</span> x, <span class="dt">z =</span> z)
l
l<span class="op">$</span>ddd &lt;-<span class="st"> </span><span class="kw">sqrt</span>(l<span class="op">$</span>x)
l[<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>]
l[[<span class="st">&quot;ddd&quot;</span>]]</code></pre>
<p>Data frames are often required for statistical modeling.
A data frame is a list where length of elements match and elements
can be in different mode.</p>
<pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> x, <span class="dt">sqrt_x =</span> <span class="kw">sqrt</span>(x))
d</code></pre>
<p>Inspect structure of R objects:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(x)
<span class="kw">str</span>(z)
<span class="kw">str</span>(m)
<span class="kw">str</span>(l)
<span class="kw">str</span>(d)
<span class="kw">str</span>(<span class="kw">as.data.frame</span>(m))
<span class="kw">str</span>(<span class="kw">as.list</span>(d))</code></pre>
<p>Get summaries of these objects:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(x)
<span class="kw">summary</span>(z)
<span class="kw">summary</span>(m)
<span class="kw">summary</span>(l)
<span class="kw">summary</span>(d)</code></pre>
</div>
<div id="josm-data-set" class="section level2">
<h2><span class="header-section-number">2.4</span> JOSM data set</h2>
<p>The data is based on the project <em>Cause-Effect Monitoring Migratory Landbirds at Regional Scales:
understand how boreal songbirds are affected by human activity in the oil sands area</em> (<a href="pcdata.html#fig:data-1">2.1</a> and <a href="pcdata.html#fig:data-2">2.2</a>, <span class="citation">(Mahon et al. <a href="#ref-mahon2016">2016</a>)</span>).
JOSM stands for Joint Oil Sands Monitoring.
Look at the source code in the <code>_data/josm</code> directory of the book
if you are interested in data processing details.
We skip that for now.</p>
<div class="figure"><span id="fig:data-1"></span>
<img src="images/mahon-2016-fig-1.png" alt="JOSM bird data survey locations from [@mahon2016]." width="80%" />
<p class="caption">
Figure 2.1: JOSM bird data survey locations from <span class="citation">(Mahon et al. <a href="#ref-mahon2016">2016</a>)</span>.
</p>
</div>
<div class="figure"><span id="fig:data-2"></span>
<img src="images/mahon-2016-fig-2.png" alt="Survey area boundary, habitat types and human footprint mapping [@mahon2016]." width="80%" />
<p class="caption">
Figure 2.2: Survey area boundary, habitat types and human footprint mapping <span class="citation">(Mahon et al. <a href="#ref-mahon2016">2016</a>)</span>.
</p>
</div>
<p>Surveys were spatially replicated because:</p>
<ul>
<li>we want to make inferences about a population,</li>
<li>full census is out of reach,</li>
<li>thus we take a sample of the population</li>
<li>that is representative and random.</li>
<li>Ideally, sample size should be as large as possible,</li>
<li>it reduces variability and</li>
<li>increases statistical power.</li>
</ul>
<p>Survey locations were pucked based on various criteria:</p>
<ul>
<li>stratification (land cover),</li>
<li>gradients (disturbance levels),</li>
<li>random location (control for unmeasured effects),</li>
<li>take into account historical surveys (avoid, or revisit),</li>
<li>access, cost (clusters).</li>
</ul>
<p>The <code>josm</code> obejct is a list with 3 elements:</p>
<ul>
<li><code>surveys</code>: data frame with survey specific information,</li>
<li><code>species</code>: lookup table for species,</li>
<li><code>counts</code>: individual counts by survey and species.</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(josm)</code></pre>
<pre><code>## [1] &quot;surveys&quot; &quot;species&quot; &quot;counts&quot;</code></pre>
<p>Species info: species codes, common and scientific names. The table could also contain
taxonomic, trait, etc. information as well.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(josm<span class="op">$</span>species)</code></pre>
<p>At the survey level, we have coordinates, date/time info,
variables capturing survey conditions, and land cover info extracted from 1 km<span class="math inline">\(^2\)</span> resolution rasters.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colnames</span>(josm<span class="op">$</span>surveys)</code></pre>
<pre><code>##  [1] &quot;SiteID&quot;        &quot;SurveyArea&quot;    &quot;Longitude&quot;     &quot;Latitude&quot;     
##  [5] &quot;Date&quot;          &quot;StationID&quot;     &quot;ObserverID&quot;    &quot;TimeStart&quot;    
##  [9] &quot;VisitID&quot;       &quot;WindStart&quot;     &quot;PrecipStart&quot;   &quot;TempStart&quot;    
## [13] &quot;CloudStart&quot;    &quot;WindEnd&quot;       &quot;PrecipEnd&quot;     &quot;TempEnd&quot;      
## [17] &quot;CloudEnd&quot;      &quot;TimeFin&quot;       &quot;Noise&quot;         &quot;OvernightRain&quot;
## [21] &quot;DateTime&quot;      &quot;SunRiseTime&quot;   &quot;SunRiseFrac&quot;   &quot;TSSR&quot;         
## [25] &quot;OrdinalDay&quot;    &quot;DAY&quot;           &quot;Open&quot;          &quot;Water&quot;        
## [29] &quot;Agr&quot;           &quot;UrbInd&quot;        &quot;SoftLin&quot;       &quot;Roads&quot;        
## [33] &quot;Decid&quot;         &quot;OpenWet&quot;       &quot;Conif&quot;         &quot;ConifWet&quot;</code></pre>
<p>The count table contains one row for each unique individual
of a species (<code>SpeciesID</code> links to the species lookup table)
observed during a survey (<code>StationID</code> links to the survey attribute table).
Check the data dictionary in <code>_data/josm</code> folder for a detailed explanation of each column.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(josm<span class="op">$</span>counts)</code></pre>
<pre><code>## &#39;data.frame&#39;:    52372 obs. of  18 variables:
##  $ ObservationID: Factor w/ 57024 levels &quot;CL10102-130622-001&quot;,..: 1 2 3 4 5 6 8 9 10 11 ...
##  $ SiteID       : Factor w/ 4569 levels &quot;CL10102&quot;,&quot;CL10106&quot;,..: 1 1 1 1 1 1 1 1 2 2 ...
##  $ StationID    : Factor w/ 4569 levels &quot;CL10102-1&quot;,&quot;CL10106-1&quot;,..: 1 1 1 1 1 1 1 1 2 2 ...
##  $ TimeInterval : int  1 1 1 1 5 5 1 1 1 1 ...
##  $ Direction    : int  1 2 2 2 1 4 4 4 1 1 ...
##  $ Distance     : int  1 2 2 1 3 3 2 1 1 1 ...
##  $ DetectType1  : Factor w/ 3 levels &quot;C&quot;,&quot;S&quot;,&quot;V&quot;: 2 2 2 2 1 1 2 2 2 2 ...
##  $ DetectType2  : Factor w/ 3 levels &quot;C&quot;,&quot;S&quot;,&quot;V&quot;: NA NA NA NA NA NA NA NA NA NA ...
##  $ DetectType3  : Factor w/ 3 levels &quot;C&quot;,&quot;S&quot;,&quot;V&quot;: NA NA NA NA NA NA NA NA NA NA ...
##  $ Sex          : Factor w/ 4 levels &quot;F&quot;,&quot;M&quot;,&quot;P&quot;,&quot;U&quot;: 2 2 2 2 4 4 2 2 2 2 ...
##  $ Age          : Factor w/ 6 levels &quot;A&quot;,&quot;F&quot;,&quot;J&quot;,&quot;JUV&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ Activity1    : Factor w/ 17 levels &quot;BE&quot;,&quot;CF&quot;,&quot;CH&quot;,..: 5 5 5 5 NA NA NA 5 5 NA ...
##  $ Activity2    : Factor w/ 17 levels &quot;48&quot;,&quot;BE&quot;,&quot;CF&quot;,..: NA NA NA NA NA NA NA NA NA NA ...
##  $ Activity3    : Factor w/ 7 levels &quot;CF&quot;,&quot;DC&quot;,&quot;DR&quot;,..: NA NA NA NA NA NA NA NA NA NA ...
##  $ ActivityNote : Factor w/ 959 levels &quot;AGITATED&quot;,&quot;AGITATED CALLING&quot;,..: NA NA NA NA NA NA NA NA NA NA ...
##  $ Dur          : Factor w/ 3 levels &quot;0-3min&quot;,&quot;3-5min&quot;,..: 1 1 1 1 3 3 1 1 1 1 ...
##  $ Dis          : Factor w/ 3 levels &quot;0-50m&quot;,&quot;50-100m&quot;,..: 1 2 2 1 3 3 2 1 1 1 ...
##  $ SpeciesID    : Factor w/ 150 levels &quot;ALFL&quot;,&quot;AMBI&quot;,..: 107 95 95 107 46 43 140 95 125 38 ...</code></pre>
</div>
<div id="cross-tabulating-species-counts" class="section level2">
<h2><span class="header-section-number">2.5</span> Cross tabulating species counts</h2>
<p>Take the following dummy data frame (long format):</p>
<pre class="sourceCode r"><code class="sourceCode r">(d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">sample=</span><span class="kw">factor</span>(<span class="kw">paste0</span>(<span class="st">&quot;S&quot;</span>, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)), <span class="kw">paste0</span>(<span class="st">&quot;S&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)),
  <span class="dt">species=</span><span class="kw">c</span>(<span class="st">&quot;BTNW&quot;</span>, <span class="st">&quot;OVEN&quot;</span>, <span class="st">&quot;CANG&quot;</span>, <span class="st">&quot;AMRO&quot;</span>, <span class="st">&quot;CANG&quot;</span>),
  <span class="dt">abundance=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>),
  <span class="dt">behavior=</span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;heard&quot;</span>,<span class="st">&quot;seen&quot;</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>))))
<span class="kw">str</span>(d)</code></pre>
<pre><code>## &#39;data.frame&#39;:    5 obs. of  4 variables:
##  $ sample   : Factor w/ 3 levels &quot;S1&quot;,&quot;S2&quot;,&quot;S3&quot;: 1 1 1 2 2
##  $ species  : Factor w/ 4 levels &quot;AMRO&quot;,&quot;BTNW&quot;,..: 2 4 3 1 3
##  $ abundance: num  1 1 2 1 1
##  $ behavior : Factor w/ 2 levels &quot;heard&quot;,&quot;seen&quot;: 1 1 1 1 2</code></pre>
<p>We want to add up the <code>abundance</code>s for each sample (rows) and species (column):</p>
<pre class="sourceCode r"><code class="sourceCode r">(y &lt;-<span class="st"> </span><span class="kw">Xtab</span>(abundance <span class="op">~</span><span class="st"> </span>sample <span class="op">+</span><span class="st"> </span>species, d))</code></pre>
<pre><code>## 3 x 4 sparse Matrix of class &quot;dgCMatrix&quot;
##    AMRO BTNW CANG OVEN
## S1    .    1    2    1
## S2    1    .    1    .
## S3    .    .    .    .</code></pre>
<p><code>y</code> is a sparse matrix, that is a very compact representation:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">object.size</span>(d[,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])</code></pre>
<pre><code>## 2328 bytes</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">object.size</span>(y)</code></pre>
<pre><code>## 2160 bytes</code></pre>
<p>Notice that we have 3 rows, but <code>d$sample</code> did not have an <code>S3</code> value, but it was a level.
We can drop such unused levels, but it is generally not recommended, and we need to be careful
not to drop samples where no species was detected (this can happen quite often depending on timing of
surveys)</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Xtab</span>(abundance <span class="op">~</span><span class="st"> </span>sample <span class="op">+</span><span class="st"> </span>species, d, <span class="dt">drop.unused.levels =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>## 2 x 4 sparse Matrix of class &quot;dgCMatrix&quot;
##    AMRO BTNW CANG OVEN
## S1    .    1    2    1
## S2    1    .    1    .</code></pre>
<p>A sparse matrix can be converted to ordinary matrix</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.matrix</span>(y)</code></pre>
<pre><code>##    AMRO BTNW CANG OVEN
## S1    0    1    2    1
## S2    1    0    1    0
## S3    0    0    0    0</code></pre>
<p>The nice thing about this cross tabulation is that we can finter the records without
changing the structure (rows, columns) of the table:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Xtab</span>(abundance <span class="op">~</span><span class="st"> </span>sample <span class="op">+</span><span class="st"> </span>species, d[d<span class="op">$</span>behavior <span class="op">==</span><span class="st"> &quot;heard&quot;</span>,])</code></pre>
<pre><code>## 3 x 4 sparse Matrix of class &quot;dgCMatrix&quot;
##    AMRO BTNW CANG OVEN
## S1    .    1    2    1
## S2    1    .    .    .
## S3    .    .    .    .</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Xtab</span>(abundance <span class="op">~</span><span class="st"> </span>sample <span class="op">+</span><span class="st"> </span>species, d[d<span class="op">$</span>behavior <span class="op">==</span><span class="st"> &quot;seen&quot;</span>,])</code></pre>
<pre><code>## 3 x 4 sparse Matrix of class &quot;dgCMatrix&quot;
##    AMRO BTNW CANG OVEN
## S1    .    .    .    .
## S2    .    .    1    .
## S3    .    .    .    .</code></pre>
<p>Now let’s do this for the real data. We have no abundance column, because
each row stands for exactly one individual. We can add a column with 1’s,
or we can just count the number of rows by using only the right-hand-side of the
formula in <code>Xtab</code>. <code>ytot</code> will be our total count matrix for now.</p>
<p>We also want to filter the records to contain only <code>S</code>ongs and <code>C</code>alls, without
<code>V</code>visual detections:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(josm<span class="op">$</span>counts<span class="op">$</span>DetectType1, <span class="dt">useNA=</span><span class="st">&quot;always&quot;</span>)</code></pre>
<pre><code>## 
##     C     S     V  &lt;NA&gt; 
##  9180 41808  1384     0</code></pre>
<p>We use <code>SiteID</code> for row names, because only 1 station and visit was done at each site:</p>
<pre class="sourceCode r"><code class="sourceCode r">ytot &lt;-<span class="st"> </span><span class="kw">Xtab</span>(<span class="op">~</span><span class="st"> </span>SiteID <span class="op">+</span><span class="st"> </span>SpeciesID, josm<span class="op">$</span>counts[josm<span class="op">$</span>counts<span class="op">$</span>DetectType1 <span class="op">!=</span><span class="st"> &quot;V&quot;</span>,])</code></pre>
<p>See how not storing 0’s affect size compared to the long formar and an ordinary wide matrix</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## 2-column data frame as reference</span>
tmp &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">object.size</span>(
  josm<span class="op">$</span>counts[josm<span class="op">$</span>counts<span class="op">$</span>DetectType1 <span class="op">!=</span><span class="st"> &quot;V&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;StationID&quot;</span>, <span class="st">&quot;SpeciesID&quot;</span>)]))
<span class="co">## spare matrix</span>
<span class="kw">as.numeric</span>(<span class="kw">object.size</span>(ytot)) <span class="op">/</span><span class="st"> </span>tmp</code></pre>
<pre><code>## [1] 0.1366</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## dense matrix</span>
<span class="kw">as.numeric</span>(<span class="kw">object.size</span>(<span class="kw">as.matrix</span>(ytot))) <span class="op">/</span><span class="st"> </span>tmp</code></pre>
<pre><code>## [1] 1.106</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## matrix fill</span>
<span class="kw">sum</span>(ytot <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">/</span><span class="st"> </span><span class="kw">prod</span>(<span class="kw">dim</span>(ytot))</code></pre>
<pre><code>## [1] 0.04911</code></pre>
<p>Check if counts are as expected:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">max</span>(ytot) <span class="co"># this is interesting</span></code></pre>
<pre><code>## [1] 200</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sort</span>(<span class="kw">apply</span>(<span class="kw">as.matrix</span>(ytot), <span class="dv">2</span>, max)) <span class="co"># it is CANG</span></code></pre>
<pre><code>## BUFF BWTE COGO COHA DCCO GWTE HOLA NHOW NSHO RTHU WWSC CANV NOPI AMBI AMCO 
##    0    0    0    0    0    0    0    0    0    0    0    0    0    1    1 
## AMGO BAEA BAOR BEKI BOWA CONI CSWA EAPH GBHE GCTH GGOW GHOW HOWR LEOW MERL 
##    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1 
## NESP NOGO NOHA NSWO PBGR RBGU RTHA SAVS SPSA WBNU BRBL CAGU MYWA SNBU VEER 
##    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1 
## AMKE AMWI BADO BARS BBWO BHCO BLBW BLPW BLTE BWHA COGR DOWO EAKI HAWO KILL 
##    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2 
## LEYE NAWA NOPO OSFL OSPR PIWO PUFI RNDU SORA SSHA COSN AMCR AMRO ATTW BHVI 
##    2    2    2    2    2    2    2    2    2    2    2    3    3    3    3 
## BOCH BRCR BTNW CMWA FOSP FRGU GCKI MAWR MOWA NOFL PHVI SACR SOSA SOSP SPGR 
##    3    3    3    3    3    3    3    3    3    3    3    3    3    3    3 
## TRES WETA WIWA WIWR YBSA FOTE BAWW BBWA BCCH BLJA CAWA CONW COTE GRYE NOWA 
##    3    3    3    3    3    3    4    4    4    4    4    4    4    4    4 
## NRWS OCWA REVI RNGR RUBL RWBL WAVI WEWP WISN YBFL YWAR ALFL AMRE CHSP CORA 
##    4    4    4    4    4    4    4    4    4    4    4    5    5    5    5 
## EVGR HETH LCSP RBGR RBNU RCKI SWSP CCSP COYE DEJU LEFL LISP MAWA OVEN RUGR 
##    5    5    5    5    5    5    5    6    6    6    6    6    6    6    6 
## SWTH BOGU MALL GRAJ PAWA WTSP YRWA COLO TEWA AMPI WWCR CEDW PISI RECR CANG 
##    6    7    7    8    8    8    8    9   12   12   20   23   50   51  200</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## lyover (FO) flock (FL) beyond 100m distance</span>
<span class="kw">head</span>(josm<span class="op">$</span>counts[
  josm<span class="op">$</span>counts<span class="op">$</span>SiteID <span class="op">==</span><span class="st"> </span><span class="kw">rownames</span>(ytot)[<span class="kw">which</span>(ytot[,<span class="st">&quot;CANG&quot;</span>] <span class="op">==</span><span class="st"> </span><span class="dv">200</span>)] <span class="op">&amp;</span>
<span class="st">  </span>josm<span class="op">$</span>counts<span class="op">$</span>SpeciesID <span class="op">==</span><span class="st"> &quot;CANG&quot;</span>,])</code></pre>
<p>We can check overall mean counts:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">round</span>(<span class="kw">sort</span>(<span class="kw">colMeans</span>(ytot)), <span class="dv">4</span>)</code></pre>
<pre><code>##   BUFF   BWTE   COGO   COHA   DCCO   GWTE   HOLA   NHOW   NSHO   RTHU 
## 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 
##   WWSC   CANV   NOPI   GBHE   GCTH   GHOW   LEOW   NOHA   RBGU   BRBL 
## 0.0000 0.0000 0.0000 0.0002 0.0002 0.0002 0.0002 0.0002 0.0002 0.0002 
##   CAGU   AMCO   BAEA   BARS   NESP   NOGO   NOPO   NSWO   RNDU   SNBU 
## 0.0002 0.0004 0.0004 0.0004 0.0004 0.0004 0.0004 0.0004 0.0004 0.0004 
##   VEER   BEKI   CSWA   MERL   SAVS   SSHA   MYWA   AMKE   BAOR   OSPR 
## 0.0004 0.0007 0.0007 0.0007 0.0007 0.0007 0.0007 0.0009 0.0009 0.0009 
##   SPGR   WBNU   AMGO   AMWI   BOWA   CONI   EAPH   HOWR   NRWS   BLTE 
## 0.0009 0.0009 0.0011 0.0011 0.0011 0.0011 0.0011 0.0011 0.0011 0.0013 
##   COGR   EAKI   GGOW   NAWA   COSN   COTE   FRGU   MAWR   FOTE   KILL 
## 0.0013 0.0013 0.0013 0.0013 0.0013 0.0015 0.0015 0.0015 0.0015 0.0018 
##   RTHA   BADO   BLBW   AMBI   PBGR   SPSA   AMPI   BHCO   BWHA   SOSP 
## 0.0020 0.0024 0.0024 0.0028 0.0028 0.0028 0.0028 0.0031 0.0037 0.0042 
##   RUBL   MALL   PUFI   DOWO   SORA   LEYE   ATTW   HAWO   RNGR   BBWO 
## 0.0044 0.0046 0.0048 0.0059 0.0068 0.0094 0.0096 0.0101 0.0101 0.0107 
##   BLJA   BOGU   AMCR   EVGR   RWBL   OSFL   LCSP   TRES   FOSP   WEWP 
## 0.0134 0.0140 0.0166 0.0169 0.0169 0.0186 0.0193 0.0201 0.0217 0.0232 
##   WIWA   PIWO   RECR   SOSA   YWAR   GCKI   BLPW   CAWA   SACR   BTNW 
## 0.0236 0.0256 0.0269 0.0269 0.0291 0.0304 0.0306 0.0315 0.0322 0.0335 
##   NOWA   OCWA   BRCR   CCSP   COLO   PHVI   CONW   CEDW   RUGR   MOWA 
## 0.0341 0.0359 0.0381 0.0385 0.0387 0.0394 0.0429 0.0449 0.0475 0.0477 
##   WAVI   BCCH   BOCH   NOFL   SWSP   GRYE   WWCR   AMRO   RBNU   BBWA 
## 0.0582 0.0593 0.0593 0.0622 0.0659 0.0685 0.0751 0.0757 0.0766 0.0810 
##   CMWA   BHVI   COYE   YBFL   YBSA   AMRE   BAWW   LEFL   WETA   WISN 
## 0.0812 0.0814 0.0814 0.0873 0.0878 0.0889 0.0963 0.0974 0.1086 0.1280 
##   CORA   WIWR   ALFL   MAWA   PISI   RBGR   LISP   DEJU   GRAJ   CANG 
## 0.1401 0.1466 0.1582 0.1727 0.1775 0.1832 0.2169 0.2725 0.2898 0.3018 
##   PAWA   REVI   RCKI   HETH   CHSP   SWTH   WTSP   OVEN   YRWA   TEWA 
## 0.3053 0.3344 0.3898 0.4344 0.4460 0.7402 0.8091 0.8831 0.8934 1.2221</code></pre>
</div>
<div id="joining-species-data-with-predictors" class="section level2">
<h2><span class="header-section-number">2.6</span> Joining species data with predictors</h2>
<p>Let’s join the species counts with the survey attributes.
This is how we can prepare the input data for regression analysis.</p>
<pre class="sourceCode r"><code class="sourceCode r">spp &lt;-<span class="st"> &quot;OVEN&quot;</span> <span class="co"># which species</span>
josm<span class="op">$</span>species[spp,]

<span class="kw">compare_sets</span>(<span class="kw">rownames</span>(josm<span class="op">$</span>surveys),<span class="kw">rownames</span>(ytot))</code></pre>
<pre><code>##        xlength ylength intersect union xbutnoty ybutnotx
## labels    4569    4569      4569  4569        0        0
## unique    4569    4569      4569  4569        0        0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span>josm<span class="op">$</span>surveys
x<span class="op">$</span>y &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(ytot[<span class="kw">rownames</span>(x), spp])</code></pre>
</div>
<div id="explore-predictor-variables" class="section level2">
<h2><span class="header-section-number">2.7</span> Explore predictor variables</h2>
<p>Put the locations on the map:</p>
<pre class="sourceCode r"><code class="sourceCode r">xy &lt;-<span class="st"> </span>x[,<span class="kw">c</span>(<span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;Latitude&quot;</span>)]
<span class="kw">coordinates</span>(xy) &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span>Longitude <span class="op">+</span><span class="st"> </span>Latitude
<span class="kw">proj4string</span>(xy) &lt;-<span class="st"> &quot;+proj=longlat +ellps=GRS80 +datum=NAD83 +no_defs&quot;</span>
xy &lt;-<span class="st"> </span><span class="kw">spTransform</span>(xy, <span class="kw">proj4string</span>(rr))
col &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&quot;lightgrey&quot;</span>, <span class="st">&quot;blue&quot;</span>))(<span class="dv">100</span>)
<span class="kw">plot</span>(rr[[<span class="st">&quot;Water&quot;</span>]], <span class="dt">col=</span>col, <span class="dt">axes=</span><span class="ot">FALSE</span>, <span class="dt">box=</span><span class="ot">FALSE</span>, <span class="dt">legend=</span><span class="ot">FALSE</span>)
<span class="kw">plot</span>(xy, <span class="dt">add=</span><span class="ot">TRUE</span>, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">cex=</span><span class="fl">0.5</span>)</code></pre>
<p><img src="qpad-book_files/figure-html/data-xy-1.png" width="672" /></p>

<div class="rmdexercise">
<p><strong>Exercise</strong></p>
Explore the data to understand the distributions and associations.
Use <code>summary</code>, <code>table</code>, <code>hist</code>, <code>plot</code> (bivariate, scatterplot matrix), etc.
</div>

</div>
<div id="derived-variables" class="section level2">
<h2><span class="header-section-number">2.8</span> Derived variables</h2>
<p>Add up some of the compositional variables into meaningful units:</p>
<pre class="sourceCode r"><code class="sourceCode r">x<span class="op">$</span>FOR &lt;-<span class="st"> </span>x<span class="op">$</span>Decid <span class="op">+</span><span class="st"> </span>x<span class="op">$</span>Conif<span class="op">+</span><span class="st"> </span>x<span class="op">$</span>ConifWet <span class="co"># forest</span>
x<span class="op">$</span>AHF &lt;-<span class="st"> </span>x<span class="op">$</span>Agr <span class="op">+</span><span class="st"> </span>x<span class="op">$</span>UrbInd <span class="op">+</span><span class="st"> </span>x<span class="op">$</span>Roads <span class="co"># &#39;alienating&#39; human footprint</span>
x<span class="op">$</span>WET &lt;-<span class="st"> </span>x<span class="op">$</span>OpenWet <span class="op">+</span><span class="st"> </span>x<span class="op">$</span>ConifWet <span class="op">+</span><span class="st"> </span>x<span class="op">$</span>Water <span class="co"># wet + water</span></code></pre>
<p>Classify surveys locations based on dominant land cover type:</p>
<pre class="sourceCode r"><code class="sourceCode r">cn &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Open&quot;</span>, <span class="st">&quot;Water&quot;</span>, <span class="st">&quot;Agr&quot;</span>, <span class="st">&quot;UrbInd&quot;</span>, <span class="st">&quot;SoftLin&quot;</span>, <span class="st">&quot;Roads&quot;</span>, <span class="st">&quot;Decid&quot;</span>, 
  <span class="st">&quot;OpenWet&quot;</span>, <span class="st">&quot;Conif&quot;</span>, <span class="st">&quot;ConifWet&quot;</span>)
h &lt;-<span class="st"> </span><span class="kw">find_max</span>(x[,cn])
<span class="kw">hist</span>(h<span class="op">$</span>value)</code></pre>
<p><img src="qpad-book_files/figure-html/data-deriv2-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(h<span class="op">$</span>index)</code></pre>
<pre><code>## 
##     Open    Water      Agr   UrbInd  SoftLin    Roads    Decid  OpenWet 
##       12       10        4       14        0        2     2084      160 
##    Conif ConifWet 
##      745     1538</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">x<span class="op">$</span>HAB &lt;-<span class="st"> </span><span class="kw">droplevels</span>(h<span class="op">$</span>index) <span class="co"># drop empty levels</span></code></pre>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-mahon2016">
<p>Mahon, C. Lisa, Gillian Holloway, Péter Sólymos, Steve G. Cumming, Erin M. Bayne, Fiona K. A. Schmiegelow, and Samantha J. Song. 2016. “Community Structure and Niche Characteristics of Upland and Lowland Western Boreal Birds at Multiple Spatial Scales.” <em>Forest Ecology and Management</em> 361: 99–116. <a href="https://doi.org/10.1016/j.foreco.2015.11.007">https://doi.org/10.1016/j.foreco.2015.11.007</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="regression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/psolymos/qpad-book/edit/master/02-data.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["qpad-book.pdf", "qpad-book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
