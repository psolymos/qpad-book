<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 3 A Primer in Regression Techniques | Point count data analysis: How to violate assumptions and get away with it</title>
  <meta name="description" content="This book provides material for the workshop ‘Analysis of point-count data in the presence of variable survey methodologies and detection error’ at the AOS 2019 conference.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 3 A Primer in Regression Techniques | Point count data analysis: How to violate assumptions and get away with it" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://peter.solymos.org/qpad-book/" />
  <meta property="og:image" content="http://peter.solymos.org/qpad-book/images/cover.png" />
  <meta property="og:description" content="This book provides material for the workshop ‘Analysis of point-count data in the presence of variable survey methodologies and detection error’ at the AOS 2019 conference." />
  <meta name="github-repo" content="psolymos/qpad-book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 A Primer in Regression Techniques | Point count data analysis: How to violate assumptions and get away with it" />
  
  <meta name="twitter:description" content="This book provides material for the workshop ‘Analysis of point-count data in the presence of variable survey methodologies and detection error’ at the AOS 2019 conference." />
  <meta name="twitter:image" content="http://peter.solymos.org/qpad-book/images/cover.png" />

<meta name="author" content="Peter Solymos">


<meta name="date" content="2019-06-07">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="pcdata.html">
<link rel="next" href="behavior.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">QPAD Book</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-book-and-the-course"><i class="fa fa-check"></i>About the book and the course</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-author"><i class="fa fa-check"></i>About the author</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#installing"><i class="fa fa-check"></i>Installing</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-this-works"><i class="fa fa-check"></i>How this works</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#design-based-approaches"><i class="fa fa-check"></i><b>1.1</b> Design-based approaches</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#model-based-approaches"><i class="fa fa-check"></i><b>1.2</b> Model-based approaches</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#our-approach"><i class="fa fa-check"></i><b>1.3</b> Our approach</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="pcdata.html"><a href="pcdata.html"><i class="fa fa-check"></i><b>2</b> Organizing and Processing Point Count Data</a><ul>
<li class="chapter" data-level="2.1" data-path="pcdata.html"><a href="pcdata.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="pcdata.html"><a href="pcdata.html#prerequisites"><i class="fa fa-check"></i><b>2.2</b> Prerequisites</a></li>
<li class="chapter" data-level="2.3" data-path="pcdata.html"><a href="pcdata.html#r-basics"><i class="fa fa-check"></i><b>2.3</b> R basics</a></li>
<li class="chapter" data-level="2.4" data-path="pcdata.html"><a href="pcdata.html#josm-data-set"><i class="fa fa-check"></i><b>2.4</b> JOSM data set</a></li>
<li class="chapter" data-level="2.5" data-path="pcdata.html"><a href="pcdata.html#cross-tabulating-species-counts"><i class="fa fa-check"></i><b>2.5</b> Cross tabulating species counts</a></li>
<li class="chapter" data-level="2.6" data-path="pcdata.html"><a href="pcdata.html#joining-species-data-with-predictors"><i class="fa fa-check"></i><b>2.6</b> Joining species data with predictors</a></li>
<li class="chapter" data-level="2.7" data-path="pcdata.html"><a href="pcdata.html#explore-predictor-variables"><i class="fa fa-check"></i><b>2.7</b> Explore predictor variables</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i><b>3</b> A Primer in Regression Techniques</a><ul>
<li class="chapter" data-level="3.1" data-path="regression.html"><a href="regression.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="regression.html"><a href="regression.html#prerequisites-1"><i class="fa fa-check"></i><b>3.2</b> Prerequisites</a></li>
<li class="chapter" data-level="3.3" data-path="regression.html"><a href="regression.html#poisson-null-model"><i class="fa fa-check"></i><b>3.3</b> Poisson null model</a></li>
<li class="chapter" data-level="3.4" data-path="regression.html"><a href="regression.html#exploring-covariates"><i class="fa fa-check"></i><b>3.4</b> Exploring covariates</a></li>
<li class="chapter" data-level="3.5" data-path="regression.html"><a href="regression.html#poisson-glm-with-one-covariate"><i class="fa fa-check"></i><b>3.5</b> Poisson GLM with one covariate</a></li>
<li class="chapter" data-level="3.6" data-path="regression.html"><a href="regression.html#additive-model"><i class="fa fa-check"></i><b>3.6</b> Additive model</a></li>
<li class="chapter" data-level="3.7" data-path="regression.html"><a href="regression.html#multiple-main-effects"><i class="fa fa-check"></i><b>3.7</b> Multiple main effects</a></li>
<li class="chapter" data-level="3.8" data-path="regression.html"><a href="regression.html#nonlinear-terms"><i class="fa fa-check"></i><b>3.8</b> Nonlinear terms</a></li>
<li class="chapter" data-level="3.9" data-path="regression.html"><a href="regression.html#categorical-variables"><i class="fa fa-check"></i><b>3.9</b> Categorical variables</a><ul>
<li class="chapter" data-level="3.9.1" data-path="regression.html"><a href="regression.html#optimal-partitioning"><i class="fa fa-check"></i><b>3.9.1</b> Optimal partitioning</a></li>
<li class="chapter" data-level="3.9.2" data-path="regression.html"><a href="regression.html#finding-optimal-combinations-of-factor-levels"><i class="fa fa-check"></i><b>3.9.2</b> Finding optimal combinations of factor levels</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="regression.html"><a href="regression.html#interactions"><i class="fa fa-check"></i><b>3.10</b> Interactions</a></li>
<li class="chapter" data-level="3.11" data-path="regression.html"><a href="regression.html#different-error-distributions"><i class="fa fa-check"></i><b>3.11</b> Different error distributions</a></li>
<li class="chapter" data-level="3.12" data-path="regression.html"><a href="regression.html#counting-time-effects"><i class="fa fa-check"></i><b>3.12</b> Counting time effects</a></li>
<li class="chapter" data-level="3.13" data-path="regression.html"><a href="regression.html#counting-radius-effects"><i class="fa fa-check"></i><b>3.13</b> Counting radius effects</a></li>
<li class="chapter" data-level="3.14" data-path="regression.html"><a href="regression.html#offsets"><i class="fa fa-check"></i><b>3.14</b> Offsets</a></li>
<li class="chapter" data-level="3.15" data-path="regression.html"><a href="regression.html#definitions"><i class="fa fa-check"></i><b>3.15</b> Definitions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="behavior.html"><a href="behavior.html"><i class="fa fa-check"></i><b>4</b> Behavioral Complexities</a></li>
<li class="chapter" data-level="5" data-path="detection.html"><a href="detection.html"><i class="fa fa-check"></i><b>5</b> The Detection Process</a></li>
<li class="chapter" data-level="6" data-path="recordings.html"><a href="recordings.html"><i class="fa fa-check"></i><b>6</b> Dealing with Recordings</a></li>
<li class="chapter" data-level="7" data-path="assumptions.html"><a href="assumptions.html"><i class="fa fa-check"></i><b>7</b> A Closer Look at Assumptions</a></li>
<li class="chapter" data-level="8" data-path="roadsides.html"><a href="roadsides.html"><i class="fa fa-check"></i><b>8</b> Understanding Roadside Surveys</a></li>
<li class="chapter" data-level="9" data-path="extras.html"><a href="extras.html"><i class="fa fa-check"></i><b>9</b> Miscellaneous Topics</a><ul>
<li class="chapter" data-level="" data-path="extras.html"><a href="extras.html#these-are-just-reminders-to-be-deleted-later"><i class="fa fa-check"></i>These are just reminders, to be deleted later</a></li>
<li class="chapter" data-level="9.1" data-path="extras.html"><a href="extras.html#binomial-model-and-censoring"><i class="fa fa-check"></i><b>9.1</b> Binomial model and censoring</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="http://peter.solymos.org/" target="blank">P&eacute;ter S&oacute;lymos</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Point count data analysis: How to violate assumptions and get away with it</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="regression" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> A Primer in Regression Techniques</h1>
<blockquote>
<p>All models are wrong, but some are useful – Box</p>
</blockquote>
<div id="introduction-1" class="section level2">
<h2><span class="header-section-number">3.1</span> Introduction</h2>
<p>This chapter will provide all the foundations we need for the coming chapters.
It is not intended as a general and all-exhaustive introduction to
regression techniques, but rather the minimum requirement moving forwards.
We will also hone our data processing and plotting skills.</p>
</div>
<div id="prerequisites-1" class="section level2">
<h2><span class="header-section-number">3.2</span> Prerequisites</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mefa4)        <span class="co"># data manipulation</span>
<span class="kw">library</span>(mgcv)         <span class="co"># GAMs</span>
<span class="kw">library</span>(pscl)         <span class="co"># zero-inflated models</span>
<span class="kw">library</span>(lme4)         <span class="co"># GLMMs</span>
<span class="kw">library</span>(MASS)         <span class="co"># Negative Binomial GLM</span>
<span class="kw">library</span>(partykit)     <span class="co"># regression trees</span>
<span class="kw">library</span>(intrval)      <span class="co"># interval magic</span>
<span class="kw">library</span>(opticut)      <span class="co"># optimal partitioning</span>
<span class="kw">library</span>(visreg)       <span class="co"># regression visualization</span>
<span class="kw">library</span>(MuMIn)        <span class="co"># multi-model inference</span>
<span class="kw">source</span>(<span class="st">&quot;functions.R&quot;</span>) <span class="co"># some useful stuff</span>
<span class="kw">load</span>(<span class="st">&quot;./_data/josm/josm.rda&quot;</span>) <span class="co"># JOSM data</span></code></pre>
</div>
<div id="poisson-null-model" class="section level2">
<h2><span class="header-section-number">3.3</span> Poisson null model</h2>
<pre class="sourceCode r"><code class="sourceCode r">spp &lt;-<span class="st"> &quot;OVEN&quot;</span> <span class="co"># which species</span>

ytot &lt;-<span class="st"> </span><span class="kw">Xtab</span>(<span class="op">~</span><span class="st"> </span>SiteID <span class="op">+</span><span class="st"> </span>SpeciesID , josm<span class="op">$</span>counts[josm<span class="op">$</span>counts<span class="op">$</span>DetectType1 <span class="op">!=</span><span class="st"> &quot;V&quot;</span>,])
ytot &lt;-<span class="st"> </span>ytot[,<span class="kw">colSums</span>(ytot <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]
x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  josm<span class="op">$</span>surveys, 
  <span class="dt">y=</span><span class="kw">as.numeric</span>(ytot[<span class="kw">rownames</span>(x), spp]))

<span class="kw">table</span>(x<span class="op">$</span>y)</code></pre>
<pre><code>## 
##    0    1    2    3    4    5    6 
## 2493  883  656  363  132   29   13</code></pre>
<p><span class="math inline">\(E[Y_i] = \lambda_i = \lambda\)</span>, <span class="math inline">\((Y_i \mid \lambda) \sim Poisson(\lambda)\)</span>,
<span class="math inline">\(log(\lambda) = \beta_0\)</span>, <span class="math inline">\(\lambda = e^{\beta_0}\)</span></p>
<p>Null model</p>
<pre class="sourceCode r"><code class="sourceCode r">mP0 &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data=</span>x, <span class="dt">family=</span>poisson)
<span class="kw">mean</span>(x<span class="op">$</span>y)</code></pre>
<pre><code>## [1] 0.8831</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(<span class="kw">fitted</span>(mP0))</code></pre>
<pre><code>## [1] 0.8831</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">exp</span>(<span class="kw">coef</span>(mP0))</code></pre>
<pre><code>## (Intercept) 
##      0.8831</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(mP0)</code></pre>
<pre><code>## 
## Call:
## glm(formula = y ~ 1, family = poisson, data = x)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
##  -1.33   -1.33   -1.33    1.02    3.57  
## 
## Coefficients:
##             Estimate Std. Error z value           Pr(&gt;|z|)    
## (Intercept)  -0.1243     0.0157   -7.89 0.0000000000000029 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 7424.8  on 4568  degrees of freedom
## Residual deviance: 7424.8  on 4568  degrees of freedom
## AIC: 12573
## 
## Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div id="exploring-covariates" class="section level2">
<h2><span class="header-section-number">3.4</span> Exploring covariates</h2>
<p>What is a useful covariate?</p>
<pre class="sourceCode r"><code class="sourceCode r">mCT &lt;-<span class="st"> </span><span class="kw">ctree</span>(y <span class="op">~</span><span class="st"> </span>Open <span class="op">+</span><span class="st"> </span>Water <span class="op">+</span><span class="st"> </span>Agr <span class="op">+</span><span class="st"> </span>UrbInd <span class="op">+</span><span class="st"> </span>SoftLin <span class="op">+</span><span class="st"> </span>Roads <span class="op">+</span><span class="st"> </span>
<span class="st">  </span>Decid <span class="op">+</span><span class="st"> </span>OpenWet <span class="op">+</span><span class="st"> </span>Conif <span class="op">+</span><span class="st"> </span>ConifWet, <span class="dt">data=</span>x)
<span class="kw">plot</span>(mCT, <span class="dt">cex=</span><span class="fl">0.5</span>)</code></pre>
<p><img src="qpad-book_files/figure-html/regr-ctree-1.png" width="672" /></p>
</div>
<div id="poisson-glm-with-one-covariate" class="section level2">
<h2><span class="header-section-number">3.5</span> Poisson GLM with one covariate</h2>
<pre class="sourceCode r"><code class="sourceCode r">mP1 &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span>Decid, <span class="dt">data=</span>x, <span class="dt">family=</span>poisson)
<span class="kw">mean</span>(x<span class="op">$</span>y)</code></pre>
<pre><code>## [1] 0.8831</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(<span class="kw">fitted</span>(mP0))</code></pre>
<pre><code>## [1] 0.8831</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(mP1)</code></pre>
<pre><code>## 
## Call:
## glm(formula = y ~ Decid, family = poisson, data = x)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -2.291  -0.977  -0.790   0.469   4.197  
## 
## Coefficients:
##             Estimate Std. Error z value            Pr(&gt;|z|)    
## (Intercept)  -1.1643     0.0352   -33.1 &lt;0.0000000000000002 ***
## Decid         2.1338     0.0537    39.7 &lt;0.0000000000000002 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 7424.8  on 4568  degrees of freedom
## Residual deviance: 5736.9  on 4567  degrees of freedom
## AIC: 10887
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">AIC</span>(mP0, mP1)</code></pre>
<pre><code>##     df   AIC
## mP0  1 12573
## mP1  2 10887</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">round</span>(<span class="kw">rbind</span>(<span class="dt">mP0=</span><span class="kw">R2dev</span>(mP0), <span class="dt">mP1=</span><span class="kw">R2dev</span>(mP1)), <span class="dv">4</span>)</code></pre>
<pre><code>##         R2  R2adj Deviance Dev0 DevR  df0  dfR p_value
## mP0 0.0000 0.0000        0 7425 7425 4568 4568       0
## mP1 0.2273 0.2272     1688 7425 5737 4568 4567       0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">xnew &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Decid=</span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.01</span>))
CI0 &lt;-<span class="st"> </span><span class="kw">predict_sim</span>(mP0, xnew, <span class="dt">interval=</span><span class="st">&quot;confidence&quot;</span>, <span class="dt">level=</span><span class="fl">0.95</span>, <span class="dt">B=</span><span class="dv">999</span>)
PI0 &lt;-<span class="st"> </span><span class="kw">predict_sim</span>(mP0, xnew, <span class="dt">interval=</span><span class="st">&quot;prediction&quot;</span>, <span class="dt">level=</span><span class="fl">0.95</span>, <span class="dt">B=</span><span class="dv">999</span>)
CI1 &lt;-<span class="st"> </span><span class="kw">predict_sim</span>(mP1, xnew, <span class="dt">interval=</span><span class="st">&quot;confidence&quot;</span>, <span class="dt">level=</span><span class="fl">0.95</span>, <span class="dt">B=</span><span class="dv">999</span>)
PI1 &lt;-<span class="st"> </span><span class="kw">predict_sim</span>(mP1, xnew, <span class="dt">interval=</span><span class="st">&quot;prediction&quot;</span>, <span class="dt">level=</span><span class="fl">0.95</span>, <span class="dt">B=</span><span class="dv">999</span>)

## nominal coverage is 95%
<span class="kw">sum</span>(x<span class="op">$</span>y <span class="op">%[]%</span><span class="st"> </span><span class="kw">predict_sim</span>(mP0, <span class="dt">interval=</span><span class="st">&quot;prediction&quot;</span>, <span class="dt">level=</span><span class="fl">0.95</span>, <span class="dt">B=</span><span class="dv">999</span>)[,<span class="kw">c</span>(<span class="st">&quot;lwr&quot;</span>, <span class="st">&quot;upr&quot;</span>)]) <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(x)</code></pre>
<pre><code>## [1] 0.9619</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(x<span class="op">$</span>y <span class="op">%[]%</span><span class="st"> </span><span class="kw">predict_sim</span>(mP1, <span class="dt">interval=</span><span class="st">&quot;prediction&quot;</span>, <span class="dt">level=</span><span class="fl">0.95</span>, <span class="dt">B=</span><span class="dv">999</span>)[,<span class="kw">c</span>(<span class="st">&quot;lwr&quot;</span>, <span class="st">&quot;upr&quot;</span>)]) <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(x)</code></pre>
<pre><code>## [1] 0.9709</code></pre>
</div>
<div id="additive-model" class="section level2">
<h2><span class="header-section-number">3.6</span> Additive model</h2>
<pre class="sourceCode r"><code class="sourceCode r">mGAM &lt;-<span class="st"> </span>mgcv<span class="op">::</span><span class="kw">gam</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(Decid), x, <span class="dt">family=</span>poisson)
<span class="kw">plot</span>(mGAM)</code></pre>
<p><img src="qpad-book_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r">fitCT &lt;-<span class="st"> </span><span class="kw">predict</span>(mCT, x[<span class="kw">order</span>(x<span class="op">$</span>Decid),])
fitGAM &lt;-<span class="st"> </span><span class="kw">predict</span>(mGAM, xnew, <span class="dt">type=</span><span class="st">&quot;response&quot;</span>)

op &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))
<span class="kw">plot</span>(<span class="kw">jitter</span>(y, <span class="fl">0.5</span>) <span class="op">~</span><span class="st"> </span>Decid, x, <span class="dt">xlab=</span><span class="st">&quot;Decid&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;E[Y]&quot;</span>,
  <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">max</span>(PI1<span class="op">$</span>upr)<span class="op">+</span><span class="dv">1</span>), <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col=</span><span class="st">&quot;#bbbbbb33&quot;</span>, <span class="dt">main=</span><span class="st">&quot;P0&quot;</span>)
<span class="kw">lines</span>(CI0<span class="op">$</span>fit <span class="op">~</span><span class="st"> </span>xnew<span class="op">$</span>Decid, <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">col=</span><span class="dv">4</span>)
<span class="kw">lines</span>(CI0<span class="op">$</span>lwr <span class="op">~</span><span class="st"> </span>xnew<span class="op">$</span>Decid, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="dv">4</span>)
<span class="kw">lines</span>(CI0<span class="op">$</span>upr <span class="op">~</span><span class="st"> </span>xnew<span class="op">$</span>Decid, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="dv">4</span>)
<span class="kw">lines</span>(PI0<span class="op">$</span>lwr <span class="op">~</span><span class="st"> </span>xnew<span class="op">$</span>Decid, <span class="dt">lty=</span><span class="dv">3</span>, <span class="dt">col=</span><span class="dv">4</span>)
<span class="kw">lines</span>(PI0<span class="op">$</span>upr <span class="op">~</span><span class="st"> </span>xnew<span class="op">$</span>Decid, <span class="dt">lty=</span><span class="dv">3</span>, <span class="dt">col=</span><span class="dv">4</span>)

<span class="kw">plot</span>(<span class="kw">jitter</span>(y, <span class="fl">0.5</span>) <span class="op">~</span><span class="st"> </span>Decid, x, <span class="dt">xlab=</span><span class="st">&quot;Decid&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;E[Y]&quot;</span>,
  <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">max</span>(PI1<span class="op">$</span>upr)<span class="op">+</span><span class="dv">1</span>), <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col=</span><span class="st">&quot;#bbbbbb33&quot;</span>, <span class="dt">main=</span><span class="st">&quot;P1&quot;</span>)
<span class="kw">lines</span>(CI1<span class="op">$</span>fit <span class="op">~</span><span class="st"> </span>xnew<span class="op">$</span>Decid, <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">col=</span><span class="dv">4</span>)
<span class="kw">lines</span>(CI1<span class="op">$</span>lwr <span class="op">~</span><span class="st"> </span>xnew<span class="op">$</span>Decid, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="dv">4</span>)
<span class="kw">lines</span>(CI1<span class="op">$</span>upr <span class="op">~</span><span class="st"> </span>xnew<span class="op">$</span>Decid, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="dv">4</span>)
<span class="kw">lines</span>(PI1<span class="op">$</span>lwr <span class="op">~</span><span class="st"> </span>xnew<span class="op">$</span>Decid, <span class="dt">lty=</span><span class="dv">3</span>, <span class="dt">col=</span><span class="dv">4</span>)
<span class="kw">lines</span>(PI1<span class="op">$</span>upr <span class="op">~</span><span class="st"> </span>xnew<span class="op">$</span>Decid, <span class="dt">lty=</span><span class="dv">3</span>, <span class="dt">col=</span><span class="dv">4</span>)

<span class="kw">plot</span>(<span class="kw">jitter</span>(y, <span class="fl">0.5</span>) <span class="op">~</span><span class="st"> </span>Decid, x, <span class="dt">xlab=</span><span class="st">&quot;Decid&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;E[Y]&quot;</span>,
  <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">max</span>(PI1<span class="op">$</span>upr)<span class="op">+</span><span class="dv">1</span>), <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col=</span><span class="st">&quot;#bbbbbb33&quot;</span>, <span class="dt">main=</span><span class="st">&quot;ctree&quot;</span>)
<span class="kw">lines</span>(fitCT <span class="op">~</span><span class="st"> </span>x<span class="op">$</span>Decid[<span class="kw">order</span>(x<span class="op">$</span>Decid)], <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">col=</span><span class="dv">4</span>)

<span class="kw">plot</span>(<span class="kw">jitter</span>(y, <span class="fl">0.5</span>) <span class="op">~</span><span class="st"> </span>Decid, x, <span class="dt">xlab=</span><span class="st">&quot;Decid&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;E[Y]&quot;</span>,
  <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">max</span>(PI1<span class="op">$</span>upr)<span class="op">+</span><span class="dv">1</span>), <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col=</span><span class="st">&quot;#bbbbbb33&quot;</span>, <span class="dt">main=</span><span class="st">&quot;GAM&quot;</span>)
<span class="kw">lines</span>(fitGAM <span class="op">~</span><span class="st"> </span>xnew<span class="op">$</span>Decid, <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">col=</span><span class="dv">4</span>)</code></pre>
<p><img src="qpad-book_files/figure-html/unnamed-chunk-26-2.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(op)</code></pre>

<div class="rmdexercise">
<p><strong>Exercise</strong></p>
Play with GAM and other variables to understand responses:
<code>plot(mgcv::gam(y ~ s(&lt;variable_name&gt;), data=x, family=poisson))</code>
</div>

</div>
<div id="multiple-main-effects" class="section level2">
<h2><span class="header-section-number">3.7</span> Multiple main effects</h2>
<pre class="sourceCode r"><code class="sourceCode r">mP2 &lt;-<span class="st"> </span><span class="kw">step</span>(<span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span>Open <span class="op">+</span><span class="st"> </span>Agr <span class="op">+</span><span class="st"> </span>UrbInd <span class="op">+</span><span class="st"> </span>SoftLin <span class="op">+</span><span class="st"> </span>Roads <span class="op">+</span><span class="st"> </span>
<span class="st">  </span>Decid <span class="op">+</span><span class="st"> </span>OpenWet <span class="op">+</span><span class="st"> </span>Conif <span class="op">+</span><span class="st"> </span>ConifWet <span class="op">+</span><span class="st"> </span>
<span class="st">  </span>OvernightRain <span class="op">+</span><span class="st"> </span>TSSR <span class="op">+</span><span class="st"> </span>DAY <span class="op">+</span><span class="st"> </span>Longitude <span class="op">+</span><span class="st"> </span>Latitude,
  <span class="dt">data=</span>x, <span class="dt">family=</span>poisson), <span class="dt">trace=</span><span class="dv">0</span>)

<span class="kw">summary</span>(mP2)</code></pre>
<pre><code>## 
## Call:
## glm(formula = y ~ Open + UrbInd + Decid + OpenWet + Conif + ConifWet + 
##     TSSR + DAY + Longitude + Latitude, family = poisson, data = x)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -2.763  -0.986  -0.674   0.451   4.624  
## 
## Coefficients:
##             Estimate Std. Error z value             Pr(&gt;|z|)    
## (Intercept) -5.88293    1.30223   -4.52      0.0000062546826 ***
## Open        -3.47428    0.65867   -5.27      0.0000001330000 ***
## UrbInd      -1.66883    0.54216   -3.08              0.00208 ** 
## Decid        0.83372    0.25957    3.21              0.00132 ** 
## OpenWet     -0.74076    0.30238   -2.45              0.01430 *  
## Conif       -0.88558    0.26566   -3.33              0.00086 ***
## ConifWet    -1.89423    0.27170   -6.97      0.0000000000031 ***
## TSSR        -1.23416    0.24984   -4.94      0.0000007818641 ***
## DAY         -2.87970    0.52686   -5.47      0.0000000460898 ***
## Longitude    0.03831    0.00877    4.37      0.0000124210771 ***
## Latitude     0.20930    0.02309    9.06 &lt; 0.0000000000000002 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 7424.8  on 4568  degrees of freedom
## Residual deviance: 5501.1  on 4558  degrees of freedom
## AIC: 10669
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">AIC</span>(mP0, mP1, mP2)</code></pre>
<pre><code>##     df   AIC
## mP0  1 12573
## mP1  2 10887
## mP2 11 10669</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">round</span>(<span class="kw">rbind</span>(<span class="dt">mP0=</span><span class="kw">R2dev</span>(mP0), <span class="dt">mP1=</span><span class="kw">R2dev</span>(mP1), <span class="dt">mP2=</span><span class="kw">R2dev</span>(mP2)), <span class="dv">4</span>)</code></pre>
<pre><code>##         R2  R2adj Deviance Dev0 DevR  df0  dfR p_value
## mP0 0.0000 0.0000        0 7425 7425 4568 4568       0
## mP1 0.2273 0.2272     1688 7425 5737 4568 4567       0
## mP2 0.2591 0.2575     1924 7425 5501 4568 4558       0</code></pre>
</div>
<div id="nonlinear-terms" class="section level2">
<h2><span class="header-section-number">3.8</span> Nonlinear terms</h2>
<p>Polynomials</p>
<pre class="sourceCode r"><code class="sourceCode r">mP12 &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span>Decid <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(Decid<span class="op">^</span><span class="dv">2</span>), <span class="dt">data=</span>x, <span class="dt">family=</span>poisson)
mP13 &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span>Decid <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(Decid<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(Decid<span class="op">^</span><span class="dv">3</span>), <span class="dt">data=</span>x, <span class="dt">family=</span>poisson)
mP14 &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span>Decid <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(Decid<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(Decid<span class="op">^</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(Decid<span class="op">^</span><span class="dv">4</span>), <span class="dt">data=</span>x, <span class="dt">family=</span>poisson)
<span class="kw">AIC</span>(mP1, mP12, mP13, mP14)</code></pre>
<pre><code>##      df   AIC
## mP1   2 10887
## mP12  3 10544
## mP13  4 10461
## mP14  5 10441</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">pr &lt;-<span class="st"> </span><span class="kw">cbind</span>(
  <span class="kw">predict</span>(mP1, xnew, <span class="dt">type=</span><span class="st">&quot;response&quot;</span>),
  <span class="kw">predict</span>(mP12, xnew, <span class="dt">type=</span><span class="st">&quot;response&quot;</span>),
  <span class="kw">predict</span>(mP13, xnew, <span class="dt">type=</span><span class="st">&quot;response&quot;</span>),
  <span class="kw">predict</span>(mP14, xnew, <span class="dt">type=</span><span class="st">&quot;response&quot;</span>),
  fitGAM)
<span class="kw">matplot</span>(xnew<span class="op">$</span>Decid, pr, <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>)</code></pre>
<p><img src="qpad-book_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
</div>
<div id="categorical-variables" class="section level2">
<h2><span class="header-section-number">3.9</span> Categorical variables</h2>
<p>Categories</p>
<pre class="sourceCode r"><code class="sourceCode r">cn &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Open&quot;</span>, <span class="st">&quot;Water&quot;</span>, <span class="st">&quot;Agr&quot;</span>, <span class="st">&quot;UrbInd&quot;</span>, <span class="st">&quot;SoftLin&quot;</span>, <span class="st">&quot;Roads&quot;</span>, <span class="st">&quot;Decid&quot;</span>, 
  <span class="st">&quot;OpenWet&quot;</span>, <span class="st">&quot;Conif&quot;</span>, <span class="st">&quot;ConifWet&quot;</span>)
h &lt;-<span class="st"> </span><span class="kw">find_max</span>(x[,cn])
<span class="kw">hist</span>(h<span class="op">$</span>value)</code></pre>
<p><img src="qpad-book_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(h<span class="op">$</span>index)</code></pre>
<pre><code>## 
##     Open    Water      Agr   UrbInd  SoftLin    Roads    Decid 
##       12       10        4       14        0        2     2084 
##  OpenWet    Conif ConifWet 
##      160      745     1538</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">x<span class="op">$</span>hab &lt;-<span class="st"> </span><span class="kw">droplevels</span>(h<span class="op">$</span>index)

mP3 &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span>hab, <span class="dt">data=</span>x, <span class="dt">family=</span>poisson)

<span class="kw">summary</span>(mP3)</code></pre>
<pre><code>## 
## Call:
## glm(formula = y ~ hab, family = poisson, data = x)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.691  -0.873  -0.817   0.449   4.832  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)   -1.386      0.577   -2.40   0.0163 * 
## habWater       1.030      0.690    1.49   0.1357   
## habAgr         0.693      0.913    0.76   0.4477   
## habUrbInd      0.134      0.764    0.17   0.8612   
## habRoads     -10.916    201.285   -0.05   0.9567   
## habDecid       1.744      0.578    3.02   0.0025 **
## habOpenWet     0.422      0.591    0.71   0.4755   
## habConif       0.913      0.579    1.58   0.1150   
## habConifWet    0.288      0.579    0.50   0.6185   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 7424.8  on 4568  degrees of freedom
## Residual deviance: 5997.2  on 4560  degrees of freedom
## AIC: 11161
## 
## Number of Fisher Scoring iterations: 10</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">AIC</span>(mP0, mP1, mP2, mP3)</code></pre>
<pre><code>##     df   AIC
## mP0  1 12573
## mP1  2 10887
## mP2 11 10669
## mP3  9 11161</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">round</span>(<span class="kw">rbind</span>(<span class="dt">mP0=</span><span class="kw">R2dev</span>(mP0), <span class="dt">mP1=</span><span class="kw">R2dev</span>(mP1), <span class="dt">mP2=</span><span class="kw">R2dev</span>(mP2), <span class="dt">mP3=</span><span class="kw">R2dev</span>(mP3)), <span class="dv">4</span>)</code></pre>
<pre><code>##         R2  R2adj Deviance Dev0 DevR  df0  dfR p_value
## mP0 0.0000 0.0000        0 7425 7425 4568 4568       0
## mP1 0.2273 0.2272     1688 7425 5737 4568 4567       0
## mP2 0.2591 0.2575     1924 7425 5501 4568 4558       0
## mP3 0.1923 0.1909     1428 7425 5997 4568 4560       0</code></pre>
<div id="optimal-partitioning" class="section level3">
<h3><span class="header-section-number">3.9.1</span> Optimal partitioning</h3>
<pre class="sourceCode r"><code class="sourceCode r">oc &lt;-<span class="st"> </span><span class="kw">opticut</span>(<span class="kw">as.matrix</span>(ytot) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">strata =</span> x<span class="op">$</span>hab, <span class="dt">dist=</span><span class="st">&quot;poisson&quot;</span>)
<span class="kw">plot</span>(oc)</code></pre>
<p><img src="qpad-book_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
</div>
<div id="finding-optimal-combinations-of-factor-levels" class="section level3">
<h3><span class="header-section-number">3.9.2</span> Finding optimal combinations of factor levels</h3>
<p>Categorical and compositional data</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># dominant hab</span>
M &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="op">~</span>hab<span class="dv">-1</span>, x)
<span class="kw">colnames</span>(M) &lt;-<span class="st"> </span><span class="kw">levels</span>(x<span class="op">$</span>hab)
ol1 &lt;-<span class="st"> </span><span class="kw">optilevels</span>(x<span class="op">$</span>y, M, <span class="dt">dist=</span><span class="st">&quot;poisson&quot;</span>)
<span class="kw">sort</span>(<span class="kw">exp</span>(<span class="kw">coef</span>(<span class="kw">bestmodel</span>(ol1))))</code></pre>
<pre><code>## `Open+UrbInd+Roads+OpenWet+ConifWet` 
##                               0.3366 
##                    `Water+Agr+Conif` 
##                               0.6232 
##                                Decid 
##                               1.4304</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## estimates
<span class="kw">exp</span>(ol1<span class="op">$</span>coef)</code></pre>
<pre><code>##         Open  Water    Agr UrbInd      Roads Decid OpenWet
##  [1,] 0.2500 0.7000 0.5000 0.2857 0.00000454  1.43  0.3813
##  [2,] 0.2692 0.7000 0.5000 0.2692 0.00000454  1.43  0.3813
##  [3,] 0.2692 0.6238 0.5000 0.2692 0.00000454  1.43  0.3812
##  [4,] 0.2692 0.6232 0.6232 0.2692 0.00000454  1.43  0.3813
##  [5,] 0.3325 0.6232 0.6232 0.3325 0.00000454  1.43  0.3813
##  [6,] 0.3370 0.6232 0.6232 0.3370 0.00000454  1.43  0.3370
##  [7,] 0.3366 0.6232 0.6232 0.3366 0.33661645  1.43  0.3366
##  [8,]     NA     NA     NA     NA         NA    NA      NA
##  [9,]     NA     NA     NA     NA         NA    NA      NA
##        Conif ConifWet
##  [1,] 0.6228   0.3336
##  [2,] 0.6228   0.3336
##  [3,] 0.6238   0.3336
##  [4,] 0.6232   0.3336
##  [5,] 0.6232   0.3325
##  [6,] 0.6232   0.3370
##  [7,] 0.6232   0.3366
##  [8,]     NA       NA
##  [9,]     NA       NA</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## optimal classification
ol1<span class="op">$</span>rank</code></pre>
<pre><code>##       Open Water Agr UrbInd Roads Decid OpenWet Conif ConifWet
##  [1,]    2     8   6      3     1     9       5     7        4
##  [2,]    2     7   5      2     1     8       4     6        3
##  [3,]    2     6   5      2     1     7       4     6        3
##  [4,]    2     5   5      2     1     6       4     5        3
##  [5,]    2     4   4      2     1     5       3     4        2
##  [6,]    2     3   3      2     1     4       2     3        2
##  [7,]    1     2   2      1     1     3       1     2        1
##  [8,]   NA    NA  NA     NA    NA    NA      NA    NA       NA
##  [9,]   NA    NA  NA     NA    NA    NA      NA    NA       NA</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">ol1<span class="op">$</span>levels[[<span class="kw">length</span>(ol1<span class="op">$</span>levels)]]</code></pre>
<pre><code>##                                 Open 
## &quot;Open+UrbInd+Roads+OpenWet+ConifWet&quot; 
##                                Water 
##                    &quot;Water+Agr+Conif&quot; 
##                                  Agr 
##                    &quot;Water+Agr+Conif&quot; 
##                               UrbInd 
## &quot;Open+UrbInd+Roads+OpenWet+ConifWet&quot; 
##                                Roads 
## &quot;Open+UrbInd+Roads+OpenWet+ConifWet&quot; 
##                                Decid 
##                              &quot;Decid&quot; 
##                              OpenWet 
## &quot;Open+UrbInd+Roads+OpenWet+ConifWet&quot; 
##                                Conif 
##                    &quot;Water+Agr+Conif&quot; 
##                             ConifWet 
## &quot;Open+UrbInd+Roads+OpenWet+ConifWet&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># composition</span>
ol2 &lt;-<span class="st"> </span><span class="kw">optilevels</span>(x<span class="op">$</span>y, x[,cn], <span class="dt">dist=</span><span class="st">&quot;poisson&quot;</span>)
<span class="kw">sort</span>(<span class="kw">exp</span>(<span class="kw">coef</span>(<span class="kw">bestmodel</span>(ol2))))</code></pre>
<pre><code>##                               Open 
##                            0.04936 
##                           ConifWet 
##                            0.18363 
## `Agr+UrbInd+SoftLin+OpenWet+Conif` 
##                            0.50444 
##                      `Water+Roads` 
##                            1.15427 
##                              Decid 
##                            2.49578</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## estimates
<span class="kw">exp</span>(ol2<span class="op">$</span>coef)</code></pre>
<pre><code>##          Open Water    Agr UrbInd SoftLin Roads Decid OpenWet
##  [1,] 0.04790 1.174 0.5579 0.4313  0.5102 1.038 2.496  0.5627
##  [2,] 0.04791 1.174 0.5625 0.4313  0.5104 1.038 2.496  0.5625
##  [3,] 0.04795 1.174 0.5628 0.4324  0.4944 1.046 2.497  0.5628
##  [4,] 0.04790 1.156 0.5628 0.4291  0.4940 1.156 2.494  0.5628
##  [5,] 0.04782 1.146 0.5632 0.4917  0.4917 1.146 2.493  0.5632
##  [6,] 0.04936 1.154 0.5044 0.5044  0.5044 1.154 2.496  0.5044
##  [7,]      NA    NA     NA     NA      NA    NA    NA      NA
##  [8,]      NA    NA     NA     NA      NA    NA    NA      NA
##  [9,]      NA    NA     NA     NA      NA    NA    NA      NA
## [10,]      NA    NA     NA     NA      NA    NA    NA      NA
##        Conif ConifWet
##  [1,] 0.4941   0.1827
##  [2,] 0.4941   0.1827
##  [3,] 0.4944   0.1828
##  [4,] 0.4940   0.1828
##  [5,] 0.4917   0.1826
##  [6,] 0.5044   0.1836
##  [7,]     NA       NA
##  [8,]     NA       NA
##  [9,]     NA       NA
## [10,]     NA       NA</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## optimal classification
ol2<span class="op">$</span>rank</code></pre>
<pre><code>##       Open Water Agr UrbInd SoftLin Roads Decid OpenWet Conif
##  [1,]    1     9   6      3       5     8    10       7     4
##  [2,]    1     8   6      3       5     7     9       6     4
##  [3,]    1     7   5      3       4     6     8       5     4
##  [4,]    1     6   5      3       4     6     7       5     4
##  [5,]    1     5   4      3       3     5     6       4     3
##  [6,]    1     4   3      3       3     4     5       3     3
##  [7,]   NA    NA  NA     NA      NA    NA    NA      NA    NA
##  [8,]   NA    NA  NA     NA      NA    NA    NA      NA    NA
##  [9,]   NA    NA  NA     NA      NA    NA    NA      NA    NA
## [10,]   NA    NA  NA     NA      NA    NA    NA      NA    NA
##       ConifWet
##  [1,]        2
##  [2,]        2
##  [3,]        2
##  [4,]        2
##  [5,]        2
##  [6,]        2
##  [7,]       NA
##  [8,]       NA
##  [9,]       NA
## [10,]       NA</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(mefa4<span class="op">::</span><span class="kw">groupSums</span>(<span class="kw">as.matrix</span>(x[,cn]), <span class="dv">2</span>, ol2<span class="op">$</span>levels[[<span class="kw">length</span>(ol2<span class="op">$</span>levels)]]))</code></pre>
<pre><code>##         Open Water+Roads Agr+UrbInd+SoftLin+OpenWet+Conif
## CL10102    0    0.073010                          0.03326
## CL10106    0    0.008431                          0.60166
## CL10108    0    0.008431                          0.60166
## CL10109    0    0.036146                          0.08157
## CL10111    0    0.050734                          0.13353
## CL10112    0    0.050734                          0.13353
##           Decid ConifWet
## CL10102 0.85691 0.036819
## CL10106 0.04429 0.345625
## CL10108 0.04429 0.345625
## CL10109 0.88228 0.000000
## CL10111 0.81394 0.001797
## CL10112 0.81394 0.001797</code></pre>
</div>
</div>
<div id="interactions" class="section level2">
<h2><span class="header-section-number">3.10</span> Interactions</h2>
<pre class="sourceCode r"><code class="sourceCode r">mP4 &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span>Decid <span class="op">+</span><span class="st"> </span>ConifWet, <span class="dt">data=</span>x, <span class="dt">family=</span>poisson)
mP5 &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span>Decid <span class="op">*</span><span class="st"> </span>ConifWet, <span class="dt">data=</span>x, <span class="dt">family=</span>poisson)
<span class="kw">AIC</span>(mP0, mP1, mP4, mP5)</code></pre>
<pre><code>##     df   AIC
## mP0  1 12573
## mP1  2 10887
## mP4  3 10791
## mP5  4 10549</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(mP5)</code></pre>
<pre><code>## 
## Call:
## glm(formula = y ~ Decid * ConifWet, family = poisson, data = x)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -2.081  -1.022  -0.484   0.374   4.321  
## 
## Coefficients:
##                Estimate Std. Error z value            Pr(&gt;|z|)
## (Intercept)     -0.5604     0.0566    -9.9 &lt;0.0000000000000002
## Decid            1.2125     0.0782    15.5 &lt;0.0000000000000002
## ConifWet        -2.3124     0.1490   -15.5 &lt;0.0000000000000002
## Decid:ConifWet   5.3461     0.3566    15.0 &lt;0.0000000000000002
##                   
## (Intercept)    ***
## Decid          ***
## ConifWet       ***
## Decid:ConifWet ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 7424.8  on 4568  degrees of freedom
## Residual deviance: 5395.2  on 4565  degrees of freedom
## AIC: 10549
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">visreg</span>(mGAM, <span class="dt">scale=</span><span class="st">&quot;response&quot;</span>)</code></pre>
<p><img src="qpad-book_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">visreg</span>(mP1, <span class="dt">scale=</span><span class="st">&quot;response&quot;</span>)</code></pre>
<p><img src="qpad-book_files/figure-html/unnamed-chunk-33-2.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">visreg</span>(mP4, <span class="dt">scale=</span><span class="st">&quot;response&quot;</span>)</code></pre>
<p><img src="qpad-book_files/figure-html/unnamed-chunk-33-3.png" width="672" /><img src="qpad-book_files/figure-html/unnamed-chunk-33-4.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">visreg</span>(mP5, <span class="dt">scale=</span><span class="st">&quot;response&quot;</span>, <span class="dt">xvar=</span><span class="st">&quot;Decid&quot;</span>, <span class="dt">by=</span><span class="st">&quot;ConifWet&quot;</span>)</code></pre>
<p><img src="qpad-book_files/figure-html/unnamed-chunk-33-5.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">round</span>(<span class="kw">rbind</span>(<span class="dt">mP0=</span><span class="kw">R2dev</span>(mP0), <span class="dt">mP1=</span><span class="kw">R2dev</span>(mP1), <span class="dt">mP2=</span><span class="kw">R2dev</span>(mP2), <span class="dt">mP3=</span><span class="kw">R2dev</span>(mP3),
  <span class="dt">mP4=</span><span class="kw">R2dev</span>(mP4), <span class="dt">mP5=</span><span class="kw">R2dev</span>(mP5)), <span class="dv">4</span>)</code></pre>
<pre><code>##         R2  R2adj Deviance Dev0 DevR  df0  dfR p_value
## mP0 0.0000 0.0000        0 7425 7425 4568 4568       0
## mP1 0.2273 0.2272     1688 7425 5737 4568 4567       0
## mP2 0.2591 0.2575     1924 7425 5501 4568 4558       0
## mP3 0.1923 0.1909     1428 7425 5997 4568 4560       0
## mP4 0.2406 0.2403     1786 7425 5638 4568 4566       0
## mP5 0.2734 0.2729     2030 7425 5395 4568 4565       0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">model.sel</span>(mP0, mP1, mP2, mP3, mP4, mP5)</code></pre>
<pre><code>## Model selection table 
##       (Int)    Dcd     Cnf     CnW   DAY    Ltt     Lng    Opn
## mP5 -0.5604 1.2130         -2.3120                            
## mP2 -5.8830 0.8337 -0.8856 -1.8940 -2.88 0.2093 0.03831 -3.474
## mP4 -0.7014 1.6220         -0.9785                            
## mP1 -1.1640 2.1340                                            
## mP3 -1.3860                                                   
## mP0 -0.1243                                                   
##         OpW    TSS    UrI hab CnW:Dcd df logLik  AICc  delta
## mP5                             5.346  4  -5271 10549    0.0
## mP2 -0.7408 -1.234 -1.669             11  -5324 10669  120.0
## mP4                                    3  -5392 10791  241.2
## mP1                                    2  -5442 10887  337.7
## mP3                         +          9  -5572 11162  612.1
## mP0                                    1  -6285 12573 2023.6
##     weight
## mP5      1
## mP2      0
## mP4      0
## mP1      0
## mP3      0
## mP0      0
## Models ranked by AICc(x)</code></pre>
</div>
<div id="different-error-distributions" class="section level2">
<h2><span class="header-section-number">3.11</span> Different error distributions</h2>
<pre class="sourceCode r"><code class="sourceCode r">mP &lt;-<span class="st"> </span>mP5 <span class="co"># best Poisson</span>
mNB &lt;-<span class="st"> </span><span class="kw">glm.nb</span>(y <span class="op">~</span><span class="st"> </span>Decid <span class="op">*</span><span class="st"> </span>ConifWet, <span class="dt">data=</span>x)
mZIP &lt;-<span class="st"> </span><span class="kw">zeroinfl</span>(y <span class="op">~</span><span class="st"> </span>Decid <span class="op">*</span><span class="st"> </span>ConifWet <span class="op">|</span><span class="st"> </span><span class="dv">1</span>, x, <span class="dt">dist=</span><span class="st">&quot;poisson&quot;</span>)
mZINB &lt;-<span class="st"> </span><span class="kw">zeroinfl</span>(y <span class="op">~</span><span class="st"> </span>Decid <span class="op">*</span><span class="st"> </span>ConifWet <span class="op">|</span><span class="st"> </span><span class="dv">1</span>, x, <span class="dt">dist=</span><span class="st">&quot;negbin&quot;</span>)

<span class="kw">AIC</span>(mP, mNB, mZIP, mZINB)</code></pre>
<pre><code>##       df   AIC
## mP     4 10549
## mNB    5 10440
## mZIP   5 10422
## mZINB  6 10419</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(mZINB)</code></pre>
<pre><code>## 
## Call:
## zeroinfl(formula = y ~ Decid * ConifWet | 1, data = x, dist = &quot;negbin&quot;)
## 
## Pearson residuals:
##    Min     1Q Median     3Q    Max 
## -1.190 -0.689 -0.338  0.361  8.956 
## 
## Count model coefficients (negbin with log link):
##                Estimate Std. Error z value             Pr(&gt;|z|)
## (Intercept)     -0.3873     0.0732   -5.29           0.00000012
## Decid            1.1195     0.0911   12.29 &lt; 0.0000000000000002
## ConifWet        -2.4230     0.1589  -15.25 &lt; 0.0000000000000002
## Decid:ConifWet   5.9227     0.3963   14.94 &lt; 0.0000000000000002
## Log(theta)       2.6504     0.5305    5.00           0.00000059
##                   
## (Intercept)    ***
## Decid          ***
## ConifWet       ***
## Decid:ConifWet ***
## Log(theta)     ***
## 
## Zero-inflation model coefficients (binomial with logit link):
##             Estimate Std. Error z value            Pr(&gt;|z|)    
## (Intercept)   -1.861      0.193   -9.64 &lt;0.0000000000000002 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 
## 
## Theta = 14.159 
## Number of iterations in BFGS optimization: 22 
## Log-likelihood: -5.2e+03 on 6 Df</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plogis</span>(<span class="kw">coef</span>(mZINB, <span class="st">&quot;zero&quot;</span>)) <span class="co"># P of 0</span></code></pre>
<pre><code>## (Intercept) 
##      0.1346</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">mZINB<span class="op">$</span>theta <span class="co"># V(mu) = mu + mu^2/theta, ~inverse of variance</span></code></pre>
<pre><code>## [1] 14.16</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Variance function, 1:1 is Poisson</span>
mu &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="fl">0.01</span>)
theta &lt;-<span class="st"> </span>mZINB<span class="op">$</span>theta
<span class="kw">plot</span>(mu, mu <span class="op">+</span><span class="st"> </span>mu<span class="op">^</span><span class="dv">2</span><span class="op">/</span>mZINB<span class="op">$</span>theta, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">col=</span><span class="dv">2</span>)
<span class="kw">lines</span>(mu, mu <span class="op">+</span><span class="st"> </span>mu<span class="op">^</span><span class="dv">2</span><span class="op">/</span>mNB<span class="op">$</span>theta, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">col=</span><span class="dv">4</span>)
<span class="kw">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>)</code></pre>
<p><img src="qpad-book_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>Poisson-Lognormal random effects, iid. and clustered:</p>
<pre class="sourceCode r"><code class="sourceCode r">mPLN1 &lt;-<span class="st"> </span><span class="kw">glmer</span>(y <span class="op">~</span><span class="st"> </span>Decid <span class="op">*</span><span class="st"> </span>ConifWet <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>SiteID), <span class="dt">data=</span>x, <span class="dt">family=</span>poisson)
mPLN2 &lt;-<span class="st"> </span><span class="kw">glmer</span>(y <span class="op">~</span><span class="st"> </span>Decid <span class="op">*</span><span class="st"> </span>ConifWet <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>SurveyArea), <span class="dt">data=</span>x, <span class="dt">family=</span>poisson)
<span class="kw">AIC</span>(mP, mNB, mZIP, mZINB, mPLN1, mPLN2)</code></pre>
<pre><code>##       df   AIC
## mP     4 10549
## mNB    5 10440
## mZIP   5 10422
## mZINB  6 10419
## mPLN1  5 10423
## mPLN2  5 10021</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(mPLN2)</code></pre>
<pre><code>## Generalized linear mixed model fit by maximum likelihood
##   (Laplace Approximation) [glmerMod]
##  Family: poisson  ( log )
## Formula: y ~ Decid * ConifWet + (1 | SurveyArea)
##    Data: x
## 
##      AIC      BIC   logLik deviance df.resid 
##    10021    10053    -5006    10011     4564 
## 
## Scaled residuals: 
##    Min     1Q Median     3Q    Max 
## -1.739 -0.643 -0.320  0.355  6.535 
## 
## Random effects:
##  Groups     Name        Variance Std.Dev.
##  SurveyArea (Intercept) 0.295    0.543   
## Number of obs: 4569, groups:  SurveyArea, 271
## 
## Fixed effects:
##                Estimate Std. Error z value            Pr(&gt;|z|)
## (Intercept)     -0.7459     0.0783   -9.53 &lt;0.0000000000000002
## Decid            1.1967     0.0984   12.16 &lt;0.0000000000000002
## ConifWet        -2.3213     0.1686  -13.77 &lt;0.0000000000000002
## Decid:ConifWet   5.5346     0.3977   13.92 &lt;0.0000000000000002
##                   
## (Intercept)    ***
## Decid          ***
## ConifWet       ***
## Decid:ConifWet ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##             (Intr) Decid  ConfWt
## Decid       -0.808              
## ConifWet    -0.610  0.628       
## Decid:CnfWt  0.162 -0.325 -0.670</code></pre>
</div>
<div id="counting-time-effects" class="section level2">
<h2><span class="header-section-number">3.12</span> Counting time effects</h2>
<pre class="sourceCode r"><code class="sourceCode r">spp &lt;-<span class="st"> &quot;OVEN&quot;</span> <span class="co"># which species</span>

ydur &lt;-<span class="st"> </span><span class="kw">Xtab</span>(<span class="op">~</span><span class="st"> </span>SiteID <span class="op">+</span><span class="st"> </span>Dur <span class="op">+</span><span class="st"> </span>SpeciesID , josm<span class="op">$</span>counts[josm<span class="op">$</span>counts<span class="op">$</span>DetectType1 <span class="op">!=</span><span class="st"> &quot;V&quot;</span>,])

y &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(ydur[[spp]])
<span class="kw">head</span>(y)</code></pre>
<pre><code>##         0-3min 3-5min 5-10min
## CL10102      3      0       0
## CL10106      0      0       0
## CL10108      0      0       0
## CL10109      2      0       1
## CL10111      2      0       0
## CL10112      2      0       0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colMeans</span>(y)</code></pre>
<pre><code>##  0-3min  3-5min 5-10min 
## 0.67367 0.09346 0.11600</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cumsum</span>(<span class="kw">colMeans</span>(y))</code></pre>
<pre><code>##  0-3min  3-5min 5-10min 
##  0.6737  0.7671  0.8831</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  josm<span class="op">$</span>surveys, 
  <span class="dt">y3=</span>y[,<span class="st">&quot;0-3min&quot;</span>],
  <span class="dt">y5=</span>y[,<span class="st">&quot;0-3min&quot;</span>]<span class="op">+</span>y[,<span class="st">&quot;3-5min&quot;</span>],
  <span class="dt">y10=</span><span class="kw">rowSums</span>(y))

<span class="kw">table</span>(x<span class="op">$</span>y3)</code></pre>
<pre><code>## 
##    0    1    2    3    4    5    6 
## 2768  922  576  226   61   14    2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(x<span class="op">$</span>y5)</code></pre>
<pre><code>## 
##    0    1    2    3    4    5    6 
## 2643  894  632  285   87   24    4</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(x<span class="op">$</span>y10)</code></pre>
<pre><code>## 
##    0    1    2    3    4    5    6 
## 2493  883  656  363  132   29   13</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">m3 &lt;-<span class="st"> </span><span class="kw">glm</span>(y3 <span class="op">~</span><span class="st"> </span>Decid, <span class="dt">data=</span>x, <span class="dt">family=</span>poisson)
m5 &lt;-<span class="st"> </span><span class="kw">glm</span>(y5 <span class="op">~</span><span class="st"> </span>Decid, <span class="dt">data=</span>x, <span class="dt">family=</span>poisson)
m10 &lt;-<span class="st"> </span><span class="kw">glm</span>(y10 <span class="op">~</span><span class="st"> </span>Decid, <span class="dt">data=</span>x, <span class="dt">family=</span>poisson)
<span class="kw">mean</span>(<span class="kw">fitted</span>(m3))</code></pre>
<pre><code>## [1] 0.6737</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(<span class="kw">fitted</span>(m5))</code></pre>
<pre><code>## [1] 0.7671</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(<span class="kw">fitted</span>(m10))</code></pre>
<pre><code>## [1] 0.8831</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)
x<span class="op">$</span>meth &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>), <span class="kw">nrow</span>(x), <span class="dt">replace=</span><span class="ot">TRUE</span>)
x<span class="op">$</span>y &lt;-<span class="st"> </span>x<span class="op">$</span>y3
x<span class="op">$</span>y[x<span class="op">$</span>meth <span class="op">==</span><span class="st"> &quot;B&quot;</span>] &lt;-<span class="st"> </span>x<span class="op">$</span>y5[x<span class="op">$</span>meth <span class="op">==</span><span class="st"> &quot;B&quot;</span>]
x<span class="op">$</span>y[x<span class="op">$</span>meth <span class="op">==</span><span class="st"> &quot;C&quot;</span>] &lt;-<span class="st"> </span>x<span class="op">$</span>y10[x<span class="op">$</span>meth <span class="op">==</span><span class="st"> &quot;C&quot;</span>]
<span class="kw">boxplot</span>(y <span class="op">~</span><span class="st"> </span>meth, x)</code></pre>
<p><img src="qpad-book_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r">mm &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span>meth <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data=</span>x, <span class="dt">family=</span>poisson)
<span class="kw">summary</span>(mm)</code></pre>
<pre><code>## 
## Call:
## glm(formula = y ~ meth - 1, family = poisson, data = x)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.309  -1.263  -1.162   0.369   3.616  
## 
## Coefficients:
##       Estimate Std. Error z value             Pr(&gt;|z|)    
## methA  -0.3929     0.0309  -12.70 &lt; 0.0000000000000002 ***
## methB  -0.2255     0.0289   -7.79   0.0000000000000066 ***
## methC  -0.1550     0.0277   -5.60   0.0000000211399604 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 7225.2  on 4569  degrees of freedom
## Residual deviance: 6941.8  on 4566  degrees of freedom
## AIC: 11657
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">exp</span>(<span class="kw">coef</span>(mm))</code></pre>
<pre><code>##  methA  methB  methC 
## 0.6751 0.7981 0.8564</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">mm &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span>Decid <span class="op">+</span><span class="st"> </span>meth, <span class="dt">data=</span>x, <span class="dt">family=</span>poisson)
<span class="kw">summary</span>(mm)</code></pre>
<pre><code>## 
## Call:
## glm(formula = y ~ Decid + meth, family = poisson, data = x)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -2.278  -0.939  -0.736   0.457   4.201  
## 
## Coefficients:
##             Estimate Std. Error z value             Pr(&gt;|z|)    
## (Intercept)  -1.4416     0.0457  -31.56 &lt; 0.0000000000000002 ***
## Decid         2.1490     0.0574   37.43 &lt; 0.0000000000000002 ***
## methB         0.1347     0.0424    3.18               0.0015 ** 
## methC         0.2705     0.0415    6.51       0.000000000073 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 6976.3  on 4568  degrees of freedom
## Residual deviance: 5442.7  on 4565  degrees of freedom
## AIC: 10159
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(<span class="kw">fitted</span>(mm) <span class="op">~</span><span class="st"> </span>meth, x)</code></pre>
<p><img src="qpad-book_files/figure-html/unnamed-chunk-36-2.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">exp</span>(<span class="kw">coef</span>(mm))</code></pre>
<pre><code>## (Intercept)       Decid       methB       methC 
##      0.2365      8.5766      1.1442      1.3106</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cumsum</span>(<span class="kw">colMeans</span>(y))</code></pre>
<pre><code>##  0-3min  3-5min 5-10min 
##  0.6737  0.7671  0.8831</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(y[,<span class="dv">1</span>]) <span class="op">*</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">exp</span>(<span class="kw">coef</span>(mm))[<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>])</code></pre>
<pre><code>##         methB  methC 
## 0.6737 0.7708 0.8829</code></pre>
<p>It is all relative, depends on reference methodology/protocol.</p>
</div>
<div id="counting-radius-effects" class="section level2">
<h2><span class="header-section-number">3.13</span> Counting radius effects</h2>
<p>Use area subsets to demonstrate use of offsets</p>
<pre class="sourceCode r"><code class="sourceCode r">spp &lt;-<span class="st"> &quot;OVEN&quot;</span> <span class="co"># which species</span>

ydis &lt;-<span class="st"> </span><span class="kw">Xtab</span>(<span class="op">~</span><span class="st"> </span>SiteID <span class="op">+</span><span class="st"> </span>Dis <span class="op">+</span><span class="st"> </span>SpeciesID , josm<span class="op">$</span>counts[josm<span class="op">$</span>counts<span class="op">$</span>DetectType1 <span class="op">!=</span><span class="st"> &quot;V&quot;</span>,])

y &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(ydis[[spp]])
<span class="kw">head</span>(y)</code></pre>
<pre><code>##         0-50m 50-100m 100+m
## CL10102     1       2     0
## CL10106     0       0     0
## CL10108     0       0     0
## CL10109     1       2     0
## CL10111     1       0     1
## CL10112     0       2     0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colMeans</span>(y)</code></pre>
<pre><code>##   0-50m 50-100m   100+m 
## 0.29241 0.49223 0.09849</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cumsum</span>(<span class="kw">colMeans</span>(y))</code></pre>
<pre><code>##   0-50m 50-100m   100+m 
##  0.2924  0.7846  0.8831</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  josm<span class="op">$</span>surveys, 
  <span class="dt">y50=</span>y[,<span class="st">&quot;0-50m&quot;</span>],
  <span class="dt">y100=</span>y[,<span class="st">&quot;0-50m&quot;</span>]<span class="op">+</span>y[,<span class="st">&quot;50-100m&quot;</span>])

<span class="kw">table</span>(x<span class="op">$</span>y50)</code></pre>
<pre><code>## 
##    0    1    2    3    4    5 
## 3521  792  228   25    2    1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(x<span class="op">$</span>y100)</code></pre>
<pre><code>## 
##    0    1    2    3    4    5    6 
## 2654  833  647  316   92   20    7</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">m50 &lt;-<span class="st"> </span><span class="kw">glm</span>(y50 <span class="op">~</span><span class="st"> </span>Decid, <span class="dt">data=</span>x, <span class="dt">family=</span>poisson)
m100 &lt;-<span class="st"> </span><span class="kw">glm</span>(y100 <span class="op">~</span><span class="st"> </span>Decid, <span class="dt">data=</span>x, <span class="dt">family=</span>poisson)
<span class="kw">mean</span>(<span class="kw">fitted</span>(m50))</code></pre>
<pre><code>## [1] 0.2924</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(<span class="kw">fitted</span>(m100))</code></pre>
<pre><code>## [1] 0.7846</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(m50)</code></pre>
<pre><code>## (Intercept)       Decid 
##      -2.265       2.126</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(m100)</code></pre>
<pre><code>## (Intercept)       Decid 
##      -1.327       2.209</code></pre>
</div>
<div id="offsets" class="section level2">
<h2><span class="header-section-number">3.14</span> Offsets</h2>
<pre class="sourceCode r"><code class="sourceCode r">m50 &lt;-<span class="st"> </span><span class="kw">glm</span>(y50 <span class="op">~</span><span class="st"> </span>Decid, <span class="dt">data=</span>x, <span class="dt">family=</span>poisson, 
  <span class="dt">offset=</span><span class="kw">rep</span>(<span class="kw">log</span>(<span class="fl">0.5</span><span class="op">^</span><span class="dv">2</span><span class="op">*</span>pi), <span class="kw">nrow</span>(x)))
m100 &lt;-<span class="st"> </span><span class="kw">glm</span>(y100 <span class="op">~</span><span class="st"> </span>Decid, <span class="dt">data=</span>x, <span class="dt">family=</span>poisson,
  <span class="dt">offset=</span><span class="kw">rep</span>(<span class="kw">log</span>(<span class="dv">1</span><span class="op">^</span><span class="dv">2</span><span class="op">*</span>pi), <span class="kw">nrow</span>(x)))
<span class="kw">coef</span>(m50)</code></pre>
<pre><code>## (Intercept)       Decid 
##      -2.024       2.126</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(m100)</code></pre>
<pre><code>## (Intercept)       Decid 
##      -2.471       2.209</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(<span class="kw">exp</span>(<span class="kw">model.matrix</span>(m50) <span class="op">%*%</span><span class="st"> </span><span class="kw">coef</span>(m50)))</code></pre>
<pre><code>## [1] 0.3723</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(<span class="kw">exp</span>(<span class="kw">model.matrix</span>(m100) <span class="op">%*%</span><span class="st"> </span><span class="kw">coef</span>(m100)))</code></pre>
<pre><code>## [1] 0.2498</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)
x<span class="op">$</span>meth &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), <span class="kw">nrow</span>(x), <span class="dt">replace=</span><span class="ot">TRUE</span>)
x<span class="op">$</span>y &lt;-<span class="st"> </span>x<span class="op">$</span>y50
x<span class="op">$</span>y[x<span class="op">$</span>meth <span class="op">==</span><span class="st"> &quot;B&quot;</span>] &lt;-<span class="st"> </span>x<span class="op">$</span>y100[x<span class="op">$</span>meth <span class="op">==</span><span class="st"> &quot;B&quot;</span>]
<span class="kw">boxplot</span>(y <span class="op">~</span><span class="st"> </span>meth, x)</code></pre>
<p><img src="qpad-book_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r">mm &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span>meth <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data=</span>x, <span class="dt">family=</span>poisson)
<span class="kw">summary</span>(mm)</code></pre>
<pre><code>## 
## Call:
## glm(formula = y ~ meth - 1, family = poisson, data = x)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.256  -1.256  -0.775   0.228   3.731  
## 
## Coefficients:
##       Estimate Std. Error z value            Pr(&gt;|z|)    
## methA  -1.2040     0.0375  -32.10 &lt;0.0000000000000002 ***
## methB  -0.2370     0.0240   -9.87 &lt;0.0000000000000002 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 7299.4  on 4569  degrees of freedom
## Residual deviance: 5587.9  on 4567  degrees of freedom
## AIC: 9066
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">exp</span>(<span class="kw">coef</span>(mm))</code></pre>
<pre><code>## methA methB 
## 0.300 0.789</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">mm &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span>Decid <span class="op">+</span><span class="st"> </span>meth, <span class="dt">data=</span>x, <span class="dt">family=</span>poisson)
<span class="kw">summary</span>(mm)</code></pre>
<pre><code>## 
## Call:
## glm(formula = y ~ Decid + meth, family = poisson, data = x)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -2.185  -0.847  -0.584   0.274   4.347  
## 
## Coefficients:
##             Estimate Std. Error z value            Pr(&gt;|z|)    
## (Intercept)  -2.2719     0.0554   -41.0 &lt;0.0000000000000002 ***
## Decid         2.1706     0.0690    31.4 &lt;0.0000000000000002 ***
## methB         0.9804     0.0445    22.0 &lt;0.0000000000000002 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 6110.2  on 4568  degrees of freedom
## Residual deviance: 4531.0  on 4566  degrees of freedom
## AIC: 8011
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(<span class="kw">fitted</span>(mm) <span class="op">~</span><span class="st"> </span>meth, x)</code></pre>
<p><img src="qpad-book_files/figure-html/unnamed-chunk-38-2.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">exp</span>(<span class="kw">coef</span>(mm))</code></pre>
<pre><code>## (Intercept)       Decid       methB 
##      0.1031      8.7632      2.6654</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cumsum</span>(<span class="kw">colMeans</span>(y))[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]</code></pre>
<pre><code>##   0-50m 50-100m 
##  0.2924  0.7846</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(y[,<span class="dv">1</span>]) <span class="op">*</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">exp</span>(<span class="kw">coef</span>(mm))[<span class="dv">3</span>])</code></pre>
<pre><code>##         methB 
## 0.2924 0.7794</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">mm &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span>Decid, <span class="dt">data=</span>x, <span class="dt">family=</span>poisson,
  <span class="dt">offset=</span><span class="kw">log</span>(<span class="kw">ifelse</span>(x<span class="op">$</span>meth <span class="op">==</span><span class="st"> &quot;A&quot;</span>, <span class="fl">0.5</span>, <span class="dv">1</span>)<span class="op">^</span><span class="dv">2</span><span class="op">*</span>pi))
<span class="kw">summary</span>(mm)</code></pre>
<pre><code>## 
## Call:
## glm(formula = y ~ Decid, family = poisson, data = x, offset = log(ifelse(x$meth == 
##     &quot;A&quot;, 0.5, 1)^2 * pi))
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -2.302  -0.836  -0.512   0.260   4.219  
## 
## Coefficients:
##             Estimate Std. Error z value            Pr(&gt;|z|)    
## (Intercept)  -2.3374     0.0453   -51.6 &lt;0.0000000000000002 ***
## Decid         2.1758     0.0690    31.5 &lt;0.0000000000000002 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 5671.1  on 4568  degrees of freedom
## Residual deviance: 4609.2  on 4567  degrees of freedom
## AIC: 8087
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(<span class="kw">fitted</span>(mm) <span class="op">~</span><span class="st"> </span>meth, x)</code></pre>
<p><img src="qpad-book_files/figure-html/unnamed-chunk-38-3.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cumsum</span>(<span class="kw">colMeans</span>(y))[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]</code></pre>
<pre><code>##   0-50m 50-100m 
##  0.2924  0.7846</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>)<span class="op">^</span><span class="dv">2</span><span class="op">*</span>pi <span class="op">*</span><span class="st"> </span><span class="kw">mean</span>(<span class="kw">exp</span>(<span class="kw">model.matrix</span>(mm) <span class="op">%*%</span><span class="st"> </span><span class="kw">coef</span>(mm))) <span class="co"># /ha</span></code></pre>
<pre><code>## [1] 0.2200 0.8798</code></pre>
</div>
<div id="definitions" class="section level2">
<h2><span class="header-section-number">3.15</span> Definitions</h2>
<p>Discuss definitions of:</p>
<ul>
<li>relative abundance,</li>
<li>abundance,</li>
<li>occupancy,</li>
<li>density.</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="pcdata.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="behavior.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/psolymos/qpad-book/edit/master/03-reqression.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["qpad-book.pdf", "qpad-book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
